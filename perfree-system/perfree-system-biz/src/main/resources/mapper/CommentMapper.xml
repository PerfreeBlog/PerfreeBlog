<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.perfree.mapper.CommentMapper">

    <select id="commentPage" resultType="com.perfree.controller.auth.comment.vo.CommentRespVO">
        select t1.*, t2.title as articleTitle,t2.slug as articleSlug, t2.type as articleType from p_comment t1
        LEFT JOIN p_article t2 on t1.articleId = t2.id
        where 1 = 1
        <if test="pageVO.content != null and pageVO.content != ''">
            <bind name="content" value="'%' + _parameter.pageVO.content + '%'" />
            and t1.content like #{content}
        </if>
        <if test="pageVO.userName != null and pageVO.userName != ''">
            <bind name="userName" value="'%' + _parameter.pageVO.userName + '%'" />
            and t1.userName like #{userName}
        </if>
        <if test="pageVO.articleId != null and pageVO.articleId != ''">
            and t1.articleId = #{pageVO.articleId}
        </if>
        <if test="pageVO.status != null and pageVO.status != ''">
            and t1.status = #{pageVO.status}
        </if>
    </select>
    <select id="queryById" resultType="com.perfree.controller.auth.comment.vo.CommentRespVO">
        select t1.*, t2.title as articleTitle,t2.slug as articleSlug, t2.type as articleType from p_comment t1
        LEFT JOIN p_article t2 on t1.articleId = t2.id
        where t1.id = #{id}
    </select>
    <select id="queryByTopPid" resultType="com.perfree.controller.auth.comment.vo.CommentRespVO">
        select t1.*, t2.title as articleTitle,t2.slug as articleSlug, t2.type as articleType from p_comment t1
        LEFT JOIN p_article t2 on t1.articleId = t2.id
        where t1.topPid = #{topPid} or t1.id = #{topPid}
        order by t1.createTime desc
    </select>
</mapper>
