import{r as m,k as oe,a as h,b as L,d as V,e as l,w as o,u as a,C as se,f as p,D as q,G as re,H as ue,j as x,t as ne,N as ie,aE as de,bM as me,O as pe,i as E,F as ce,l as fe,h as _e,m as g,q as ge,s as ve,E as be,y as we,Q as he,v as Ve,B as ye}from"./index-DAZg6KgI.js";import{E as ke,a as xe,v as Ne}from"./el-table-column-DZMpWYo5.js";import"./el-dialog-Cx6vfFNe.js";import{E as Ue}from"./el-pagination-x5Aplci8.js";import{p as Ee}from"./perfree-h22k_lv_.js";import{E as Ce,a as Fe}from"./el-col-Y4mM9eD_.js";import{d as Re}from"./role-DFWIJcAV.js";import{E as M}from"./index-DNxUcOTo.js";import{E as Ae}from"./index-AgTUDQsJ.js";function ze(u){return axios.post("/api/auth/user/page",u)}function Be(u){return axios.get("/api/auth/user/get?id="+u)}function Te(u){return axios.post("/api/auth/user/add",u)}function Pe(u){return axios.post("/api/auth/user/update",u)}function Se(u){return axios.delete("/api/auth/user/del?id="+u)}function De(u){return axios.post("/api/auth/user/updateUserRole",u)}function Le(u){return axios.get("/api/auth/user/getUserRole?id="+u)}function qe(u){return axios.post("/api/auth/user/resetPassword",u)}const Me={class:"page"},$e={class:"search-box"},Oe={class:"right-tool"},je={class:"table-box"},Ie={class:"dialog-footer"},Ge={class:"dialog-footer"},ll={__name:"UserView",setup(u){const i=m({pageNo:1,pageSize:20,total:0,userName:"",account:""}),r=m({id:"",userName:"",account:"",password:"",email:"",website:""}),d=m({id:"",userName:"",account:"",roles:""}),$=oe({userName:[{required:!0,message:"请输入昵称",trigger:"blur"},{min:2,max:20,message:"昵称必须在2-20字之间",trigger:"blur"}],account:[{required:!0,message:"请输入账户",trigger:"blur"},{min:5,max:16,message:"账户必须在5-16字之间",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:5,max:16,message:"密码必须在5-16字之间",trigger:"blur"}]}),B=m(),N=m(),U=m();let f=m(!1),v=m(!1),y=m(""),T=m([]),C=m(!1),F=m(!1),P=m([]);function O(s){M.prompt("请输入["+s.userName+"]的新密码","提示",{confirmButtonText:"确认",cancelButtonText:"取消",inputValidator:j,inputPlaceholder:"请输入新密码",inputErrorMessage:"请输入新密码"}).then(({value:e})=>{qe({id:s.id,password:e}).then(n=>{n.code===200?g.success("重置成功"):g.error(n.msg)})}).catch(()=>{})}function j(s){return s}function I(){U.value.validate(s=>{s&&De(d.value).then(e=>{e.code===200?(g.success("操作成功"),v.value=!1,R(),b()):g.error(e.msg)})})}function R(){d.value={id:"",userName:"",account:"",roles:""},U.value&&U.value.resetFields()}function G(){N.value.validate(s=>{s&&(r.value.id?(r.value.password=null,Pe(r.value).then(e=>{e.code===200?(g.success("更新成功"),f.value=!1,k(),b()):g.error(e.msg)})):Te(r.value).then(e=>{e.code===200?(g.success("添加成功"),f.value=!1,k(),b()):g.error(e.msg)}))})}function H(){k(),y.value="添加用户",f.value=!0,F.value=!1}function Q(s){k(),y.value="修改用户",f.value=!0,F.value=!0,Be(s.id).then(e=>{r.value=e.data,r.value.password=""})}function J(s){M.confirm("确定要删除["+s.userName+"]吗？","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(()=>{Se(s.id).then(e=>{e.code===200&&e.data?(g.success("删除成功"),b()):g.error(e.msg)})}).catch(()=>{})}function b(){C.value=!0,ze(i.value).then(s=>{T.value=s.data.list,i.value.total=s.data.total,C.value=!1})}function K(){i.value={userName:"",account:""},B.value.resetFields()}function k(){r.value={id:"",userName:"",account:"",password:"",email:"",website:""},N.value&&N.value.resetFields()}function W(s){R(),d.value.id=s.id,d.value.userName=s.userName,d.value.account=s.account,Re().then(e=>{P.value=e.data,Le(s.id).then(n=>{d.value.roles=n.data.roles})}),y.value="分配角色",v.value=!0}return b(),(s,e)=>{const n=ge,_=ve,c=be,A=we,X=Ce,Y=Fe,w=ke,S=he,Z=xe,ee=Ue,le=ye,ae=Ve,D=Ae,te=Ne;return h(),L("div",Me,[V("div",$e,[l(A,{inline:!0,model:a(i),class:"demo-form-inline",ref_key:"searchFormRef",ref:B},{default:o(()=>[l(_,{label:"昵称"},{default:o(()=>[l(n,{modelValue:a(i).userName,"onUpdate:modelValue":e[0]||(e[0]=t=>a(i).userName=t),placeholder:"请输入昵称",clearable:""},null,8,["modelValue"])]),_:1}),l(_,{label:"账户"},{default:o(()=>[l(n,{modelValue:a(i).account,"onUpdate:modelValue":e[1]||(e[1]=t=>a(i).account=t),placeholder:"请输入账户",clearable:""},null,8,["modelValue"])]),_:1}),l(_,null,{default:o(()=>[l(c,{type:"primary",onClick:b,icon:a(se)},{default:o(()=>[p("查询")]),_:1},8,["icon"]),l(c,{icon:a(q),onClick:K},{default:o(()=>[p("重置")]),_:1},8,["icon"])]),_:1})]),_:1},8,["model"])]),l(Y,{gutter:10,class:"mb8"},{default:o(()=>[l(X,{span:1.5},{default:o(()=>[l(c,{icon:a(re),type:"primary",plain:"",onClick:H},{default:o(()=>[p("新增")]),_:1},8,["icon"])]),_:1}),V("div",Oe,[l(c,{icon:a(q),circle:"",onClick:b},null,8,["icon"])])]),_:1}),V("div",je,[ue((h(),x(Z,{data:a(T),style:{width:"100%",height:"100%"},"row-key":"id"},{default:o(()=>[l(w,{label:"序号","min-width":"80",type:"index"}),l(w,{prop:"userName",label:"用户名称","min-width":"150"}),l(w,{prop:"account",label:"账号","min-width":"150"}),l(w,{prop:"status",label:"状态","min-width":"100"},{default:o(t=>[t.row.status===0?(h(),x(S,{key:0,class:"ml-2",type:"success"},{default:o(()=>[p("开启")]),_:1})):(h(),x(S,{key:1,class:"ml-2",type:"danger"},{default:o(()=>[p("关闭")]),_:1}))]),_:1}),l(w,{prop:"email",label:"邮箱","min-width":"150"}),l(w,{prop:"website",label:"网站","min-width":"150"}),l(w,{prop:"createTime",label:"创建时间","min-width":"120"},{default:o(t=>[V("span",null,ne(a(Ee)(t.row.createTime)),1)]),_:1}),l(w,{label:"操作",width:"300",fixed:"right"},{default:o(t=>[l(c,{size:"small",type:"primary",link:"",icon:a(ie),onClick:z=>Q(t.row)},{default:o(()=>[p("修改")]),_:2},1032,["icon","onClick"]),l(c,{size:"small",type:"primary",link:"",icon:a(de),onClick:z=>W(t.row)},{default:o(()=>[p("分配角色")]),_:2},1032,["icon","onClick"]),l(c,{size:"small",type:"primary",link:"",icon:a(me),onClick:z=>O(t.row)},{default:o(()=>[p("重置密码")]),_:2},1032,["icon","onClick"]),l(c,{size:"small",type:"primary",link:"",icon:a(pe),onClick:z=>J(t.row)},{default:o(()=>[p("删除")]),_:2},1032,["icon","onClick"])]),_:1})]),_:1},8,["data"])),[[te,a(C)]]),l(ee,{"current-page":a(i).pageNo,"onUpdate:currentPage":e[2]||(e[2]=t=>a(i).pageNo=t),"page-size":a(i).pageSize,"onUpdate:pageSize":e[3]||(e[3]=t=>a(i).pageSize=t),"page-sizes":[10,20,30,50],layout:"total,sizes,prev, pager, next, jumper",background:"",small:"",onChange:b,total:a(i).total},null,8,["current-page","page-size","total"])]),l(D,{modelValue:a(v),"onUpdate:modelValue":e[8]||(e[8]=t=>E(v)?v.value=t:v=t),title:a(y),width:"600px",draggable:""},{footer:o(()=>[V("span",Ie,[l(c,{type:"primary",onClick:I},{default:o(()=>[p("确 定")]),_:1}),l(c,{onClick:e[7]||(e[7]=t=>{E(v)?v.value=!1:v=!1,R()})},{default:o(()=>[p("取 消")]),_:1})])]),default:o(()=>[l(A,{ref_key:"userRoleFormRef",ref:U,model:a(d),"label-width":"80px","status-icon":""},{default:o(()=>[l(_,{label:"昵称",prop:"userName"},{default:o(()=>[l(n,{modelValue:a(d).userName,"onUpdate:modelValue":e[4]||(e[4]=t=>a(d).userName=t),disabled:"",placeholder:"请输入昵称"},null,8,["modelValue"])]),_:1}),l(_,{label:"账户",prop:"account"},{default:o(()=>[l(n,{modelValue:a(d).account,"onUpdate:modelValue":e[5]||(e[5]=t=>a(d).account=t),disabled:"",placeholder:"请输入账户"},null,8,["modelValue"])]),_:1}),l(_,{label:"角色",prop:"roles"},{default:o(()=>[l(ae,{modelValue:a(d).roles,"onUpdate:modelValue":e[6]||(e[6]=t=>a(d).roles=t),clearable:"",multiple:"",placeholder:"请选择角色",style:{width:"100%"}},{default:o(()=>[(h(!0),L(ce,null,fe(a(P),t=>(h(),x(le,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(D,{modelValue:a(f),"onUpdate:modelValue":e[15]||(e[15]=t=>E(f)?f.value=t:f=t),title:a(y),width:"600px",draggable:""},{footer:o(()=>[V("span",Ge,[l(c,{type:"primary",onClick:G},{default:o(()=>[p("确 定")]),_:1}),l(c,{onClick:e[14]||(e[14]=t=>{E(f)?f.value=!1:f=!1,k()})},{default:o(()=>[p("取 消")]),_:1})])]),default:o(()=>[l(A,{ref_key:"addFormRef",ref:N,model:a(r),"label-width":"60px","status-icon":"",rules:a($)},{default:o(()=>[l(_,{label:"昵称",prop:"userName"},{default:o(()=>[l(n,{modelValue:a(r).userName,"onUpdate:modelValue":e[9]||(e[9]=t=>a(r).userName=t),placeholder:"请输入昵称"},null,8,["modelValue"])]),_:1}),l(_,{label:"账户",prop:"account"},{default:o(()=>[l(n,{modelValue:a(r).account,"onUpdate:modelValue":e[10]||(e[10]=t=>a(r).account=t),placeholder:"请输入账户"},null,8,["modelValue"])]),_:1}),a(F)?_e("",!0):(h(),x(_,{key:0,label:"密码",prop:"password"},{default:o(()=>[l(n,{modelValue:a(r).password,"onUpdate:modelValue":e[11]||(e[11]=t=>a(r).password=t),type:"password","show-password":"",placeholder:"请输入密码"},null,8,["modelValue"])]),_:1})),l(_,{label:"邮箱",prop:"email"},{default:o(()=>[l(n,{modelValue:a(r).email,"onUpdate:modelValue":e[12]||(e[12]=t=>a(r).email=t),placeholder:"请输入邮箱地址"},null,8,["modelValue"])]),_:1}),l(_,{label:"网站",prop:"website"},{default:o(()=>[l(n,{modelValue:a(r).website,"onUpdate:modelValue":e[13]||(e[13]=t=>a(r).website=t),placeholder:"请输入网站地址"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}};export{ll as default};
