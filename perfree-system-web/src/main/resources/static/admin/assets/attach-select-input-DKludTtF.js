import{_ as ue,r,k as re,aU as T,a as i,b as _,d as u,e as t,w as o,u as e,C as ie,f as h,D as ce,F as M,l as j,j as S,a1 as q,t as B,K as pe,i as A,m as $,q as O,s as me,E as K,y as _e,a5 as fe,B as he,v as ve,ap as ge,bf as ye,h as be}from"./index-CihRDGxx.js";import"./el-dialog-DFE0lXHY.js";import{E as Ve}from"./el-image-viewer-EMjiGCdX.js";import{E as ke}from"./el-pagination-DVMT5liM.js";import{E as xe,a as we}from"./el-col-BEhwhFzy.js";/* empty css                */import{a as Ee,b as Fe,c as Ae,E as Ce,g as ze}from"./attach-BUqG8fMY.js";/* empty css                                                                            */import{E as Ue}from"./index-Bt2gs6dP.js";import{E as H}from"./index-uh3ESdbA.js";const Se={class:"page"},Ie={class:"search-box"},Ge={class:"table-box"},Re={class:"attach-preview"},Ne={class:"image-slot"},Te={key:1,preload:"none",controls:"",style:{width:"100%","max-height":"100%"}},$e=["src"],Be={key:2,class:"attach-other"},De={class:"attach-name"},Le={class:"operate-btn-box"},Pe={style:{"padding-right":"15px"}},Me={key:1,preload:"none",controls:"",style:{width:"100%","max-height":"100%"}},je=["src"],qe={key:2,controls:"",preload:"none"},Oe=["src"],Ke={key:3},He={class:"showForm"},Je={class:"dialog-footer"},Qe={__name:"attach-select-panel",props:["attachType","max"],emits:["update:selectedAttach"],setup(I,{emit:G}){const c=r(),d=r({pageNo:1,pageSize:8,total:0,name:"",type:""});let f=r([]),v=r(!1),V=r(new Map);const g=G,x=I;let m=r(!1),C=r(""),z=r([]);const p=r(),a=r({name:"",type:"",attachGroup:"default",path:"",url:"",desc:""}),w=re({name:[{required:!0,message:"请输入附件名称",trigger:"blur"}]});function F(){a.value={name:"",type:"",attachGroup:"default",path:"",url:"",desc:""},p.value&&p.value.resetFields()}function E(){x.attachType&&(d.value.type=x.attachType),v.value=!0,Ee(d.value).then(n=>{n.data.list.forEach(s=>{const y=V.value.has(s.id);s.selected=y}),f.value=n.data.list,d.value.total=n.data.total,v.value=!1})}function k(){d.value={attachConfigId:void 0,attachGroup:void 0,storage:void 0,name:""},c.value.resetFields()}function J(n){if(!n.selected&&V.value.size>=x.max){$.error(`最多选择${x.max}个`);return}n.selected=!n.selected,n.selected?V.value.set(n.id,n):V.value.delete(n.id),g("update:selectedAttach",Array.from(V.value.values()))}function Q(){ze().then(n=>{z.value=n.data})}function W(n){F(),Q(),Fe(n.id).then(s=>{a.value=s.data,C.value="详情",m.value=!0})}function X(){p.value.validate(n=>{n&&Ae(a.value).then(s=>{s.code===200?($.success("修改成功"),m.value=!1,F(),E()):$.error(s.msg)})})}return E(),(n,s)=>{const y=O,b=me,U=K,D=_e,Y=T("Loading"),R=fe,L=Ve,Z=Ue,ee=T("InfoFilled"),te=T("SuccessFilled"),N=xe,P=we,le=ke,ae=Ce,oe=he,se=ve,ne=H;return i(),_("div",Se,[u("div",Ie,[t(D,{inline:!0,model:e(d),class:"demo-form-inline",ref_key:"searchFormRef",ref:c},{default:o(()=>[t(b,{label:"附件名称"},{default:o(()=>[t(y,{modelValue:e(d).name,"onUpdate:modelValue":s[0]||(s[0]=l=>e(d).name=l),placeholder:"请输入附件名称",clearable:""},null,8,["modelValue"])]),_:1}),t(b,null,{default:o(()=>[t(U,{type:"primary",onClick:E,icon:e(ie)},{default:o(()=>[h("查询")]),_:1},8,["icon"]),t(U,{icon:e(ce),onClick:k},{default:o(()=>[h("重置")]),_:1},8,["icon"])]),_:1})]),_:1},8,["model"])]),u("div",Ge,[t(P,{gutter:15},{default:o(()=>[(i(!0),_(M,null,j(e(f),l=>(i(),S(N,{span:6,class:"attach-col",onClick:de=>J(l)},{default:o(()=>[u("div",{class:q({"attach-block":!0,selected:l.selected})},[u("div",Re,[l.type&&l.type==="img"?(i(),S(L,{key:l.url,src:l.url,lazy:"",class:"attach-img",loading:"lazy"},{placeholder:o(()=>[u("div",Ne,[t(R,{class:"is-loading"},{default:o(()=>[t(Y)]),_:1})])]),_:2},1032,["src"])):l.type&&l.type==="video"?(i(),_("video",Te,[u("source",{src:l.url},null,8,$e)])):(i(),_("div",Be,B(l.path.split(".").pop()),1))]),u("div",De,[t(Z,{"line-clamp":"1",style:{width:"100%"}},{default:o(()=>[h(B(l.name),1)]),_:2},1024)]),u("div",{class:q({"operate-mask":!0,selected:l.selected})},null,2),u("div",Le,[t(R,{class:"operate-btn",onClick:pe(de=>W(l),["stop"])},{default:o(()=>[t(ee)]),_:2},1032,["onClick"]),t(R,{class:"operate-btn select-btn"},{default:o(()=>[t(te)]),_:1})])],2)]),_:2},1032,["onClick"]))),256))]),_:1}),t(le,{"current-page":e(d).pageNo,"onUpdate:currentPage":s[1]||(s[1]=l=>e(d).pageNo=l),"page-size":e(d).pageSize,"onUpdate:pageSize":s[2]||(s[2]=l=>e(d).pageSize=l),"page-sizes":[8,16,24],layout:"total,sizes,prev, pager, next, jumper",background:"",small:"",onChange:E,total:e(d).total},null,8,["current-page","page-size","total"])]),t(ne,{modelValue:e(m),"onUpdate:modelValue":s[10]||(s[10]=l=>A(m)?m.value=l:m=l),title:e(C),width:"800px",draggable:""},{footer:o(()=>[u("span",Je,[t(U,{type:"primary",onClick:X},{default:o(()=>[h("修 改")]),_:1}),t(U,{onClick:s[9]||(s[9]=l=>{A(m)?m.value=!1:m=!1,F()})},{default:o(()=>[h("取 消")]),_:1})])]),default:o(()=>[t(P,null,{default:o(()=>[t(N,{xs:24,sm:12,md:12,lg:12,xl:12},{default:o(()=>[u("div",Pe,[e(a).type&&e(a).type==="img"?(i(),S(L,{key:0,style:{width:"100%","max-height":"100%"},src:e(a).url,"zoom-rate":1.2,"max-scale":7,"min-scale":.2,"preview-src-list":[e(a).url],"initial-index":4,fit:"cover"},null,8,["src","preview-src-list"])):e(a).type&&e(a).type==="video"?(i(),_("video",Me,[u("source",{src:e(a).url},null,8,je)])):e(a).type&&e(a).type==="audio"?(i(),_("audio",qe,[u("source",{src:e(a).url},null,8,Oe)])):(i(),_("i",Ke,[h("无法预览，点击 "),t(ae,{type:"primary",underline:!1,style:{"font-size":"12px","vertical-align":"baseline"},target:"_blank",href:"/api/attach/file/"+e(a).configId+"/get/"+e(a).path},{default:o(()=>[h("下载 ")]),_:1},8,["href"])]))])]),_:1}),t(N,{xs:24,sm:12,md:12,lg:12,xl:12},{default:o(()=>[u("div",He,[t(D,{ref_key:"showFormRef",ref:p,model:e(a),"label-width":"auto",rules:e(w),"label-position":"top"},{default:o(()=>[t(b,{label:"附件名称",prop:"name"},{default:o(()=>[t(y,{modelValue:e(a).name,"onUpdate:modelValue":s[3]||(s[3]=l=>e(a).name=l)},null,8,["modelValue"])]),_:1}),t(b,{label:"附件类型"},{default:o(()=>[t(y,{modelValue:e(a).type,"onUpdate:modelValue":s[4]||(s[4]=l=>e(a).type=l),disabled:""},null,8,["modelValue"])]),_:1}),t(b,{label:"分组"},{default:o(()=>[t(se,{modelValue:e(a).attachGroup,"onUpdate:modelValue":s[5]||(s[5]=l=>e(a).attachGroup=l),placeholder:"请选择分组",filterable:"",style:{width:"100%"},"allow-create":""},{default:o(()=>[(i(!0),_(M,null,j(e(z),l=>(i(),S(oe,{key:l.attachGroup,label:l.attachGroup,value:l.attachGroup},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(b,{label:"存储路径"},{default:o(()=>[t(y,{modelValue:e(a).path,"onUpdate:modelValue":s[6]||(s[6]=l=>e(a).path=l),disabled:""},null,8,["modelValue"])]),_:1}),t(b,{label:"访问地址"},{default:o(()=>[t(y,{modelValue:e(a).url,"onUpdate:modelValue":s[7]||(s[7]=l=>e(a).url=l),disabled:""},null,8,["modelValue"])]),_:1}),t(b,{label:"附件描述"},{default:o(()=>[t(y,{modelValue:e(a).desc,"onUpdate:modelValue":s[8]||(s[8]=l=>e(a).desc=l),autosize:{minRows:2,maxRows:4},type:"textarea",resize:"none",placeholder:"请输入附件描述"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])])]),_:1})]),_:1})]),_:1},8,["modelValue","title"])])}}},We=ue(Qe,[["__scopeId","data-v-17f6d43b"]]),Xe={style:{width:"100%"}},Ye={class:"dialog-footer"},Ze={key:0},it={__name:"attach-select-input",props:["attachType","spliter","enableInput","placeholder","modelValue"],emits:["update:modelValue"],setup(I,{emit:G}){r("请选择图片");let c=r(!1),d=r(""),f=r([]);const v=I,V=G,g=r(v.modelValue);ge(()=>v.modelValue,(p,a)=>{g.value=p});function x(){c.value=!0,d.value="请选择附件"}function m(){let p="";f.value.forEach((a,w)=>{p+=a.url}),g.value=p,c.value=!1,f.value=[],V("update:modelValue",g.value)}function C(){c.value=!1,f.value=[]}function z(p){f.value=p}return(p,a)=>{const w=K,F=O,E=H;return i(),_("div",Xe,[t(F,{modelValue:e(g),"onUpdate:modelValue":a[0]||(a[0]=k=>A(g)?g.value=k:null),placeholder:v.placeholder,style:{width:"100%"},disabled:!v.enableInput},{append:o(()=>[t(w,{icon:e(ye),type:"info",onClick:x},null,8,["icon"])]),_:1},8,["modelValue","placeholder","disabled"]),t(E,{modelValue:e(c),"onUpdate:modelValue":a[2]||(a[2]=k=>A(c)?c.value=k:c=k),title:e(d),width:"800px",draggable:"","destroy-on-close":""},{footer:o(()=>[u("span",Ye,[t(w,{type:"primary",onClick:m},{default:o(()=>[h("确 定"),e(f).length>0?(i(),_("span",Ze,"(已选"+B(e(f).length)+"个)",1)):be("",!0)]),_:1}),t(w,{onClick:a[1]||(a[1]=k=>{A(c)?c.value=!1:c=!1,C()})},{default:o(()=>[h("取 消")]),_:1})])]),default:o(()=>[t(We,{"onUpdate:selectedAttach":z,max:1,"attach-type":v.attachType},null,8,["attach-type"])]),_:1},8,["modelValue","title"])])}}};export{We as A,it as _};
