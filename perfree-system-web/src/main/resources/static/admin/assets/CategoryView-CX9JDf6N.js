import{r as p,l as S,a as d,y as Q,b as v,d as W,e as w,f as e,w as o,u as a,z as X,h as r,B as z,C as B,D as Y,k as V,i as Z,M as ee,N as le,j as K,$ as ae,n as te,E as h,p as oe}from"./index-sKYmNANA.js";import{c as ne,a as ie,b as de,d as se,e as re}from"./category-BFkxnEz5.js";const ue={class:"page"},me={class:"search-box"},ce={class:"right-tool"},pe={class:"table-box"},fe={class:"dialog-footer"},ge={__name:"CategoryView",setup(_e){const D=p(),b=p({name:""});let k=p(!1),x=p([]),R=p([]),s=p(!1),C=p("");const O=S({children:"children",label:"name",value:"id"}),n=p({pid:-1,id:"",name:"",desc:"",metaKeywords:"",thumbnail:"",slug:"",metaDescription:""}),N=S({pid:[{required:!0,message:"请选择父级分类",trigger:"blur"}],name:[{required:!0,message:"请输入分类名称",trigger:"blur"}]}),y=p();function f(){k.value=!0,ne(b.value).then(i=>{x.value=te(i.data,"id","pid","children",-1),R.value=[{id:-1,name:"主类目",children:x.value}],k.value=!1})}function T(){b.value={name:""},D.value.resetFields()}function F(i){g(),i&&i.id&&(n.value.pid=i.id),C.value="添加分类",s.value=!0}function g(){n.value={pid:-1,id:"",name:"",desc:"",metaKeywords:"",thumbnail:"",slug:"",metaDescription:""},y.value&&y.value.resetFields()}function $(){y.value.validate(i=>{i&&(n.value.id?ie(n.value).then(l=>{l.code===200?(h.success("修改成功"),s.value=!1,g(),f()):h.error(l.msg)}):de(n.value).then(l=>{l.code===200?(h.success("添加成功"),s.value=!1,g(),f()):h.error(l.msg)}))})}function M(i){C.value="修改分类",g(),se(i.id).then(l=>{n.value=l.data,s.value=!0})}function q(i){oe.confirm("确定要删除["+i.name+"]吗？","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(()=>{re(i.id).then(l=>{l.code===200&&l.data?(h.success("删除成功"),f()):h.error(l.msg)})}).catch(()=>{})}return f(),(i,l)=>{const _=d("el-input"),u=d("el-form-item"),m=d("el-button"),U=d("el-form"),L=d("el-col"),j=d("el-row"),c=d("el-table-column"),G=d("el-image"),A=d("el-tag"),I=d("el-table"),P=d("el-tree-select"),H=d("el-dialog"),J=Q("loading");return v(),W("div",ue,[w("div",me,[e(U,{inline:!0,model:a(b),ref_key:"searchFormRef",ref:D},{default:o(()=>[e(u,{label:"分类名称"},{default:o(()=>[e(_,{modelValue:a(b).name,"onUpdate:modelValue":l[0]||(l[0]=t=>a(b).name=t),placeholder:"请输入分类名称",clearable:""},null,8,["modelValue"])]),_:1}),e(u,null,{default:o(()=>[e(m,{type:"primary",onClick:f,icon:a(X)},{default:o(()=>[r("查询")]),_:1},8,["icon"]),e(m,{icon:a(z),onClick:T},{default:o(()=>[r("重置")]),_:1},8,["icon"])]),_:1})]),_:1},8,["model"])]),e(j,{gutter:10,class:"mb8"},{default:o(()=>[e(L,{span:1.5},{default:o(()=>[e(m,{icon:a(B),type:"primary",plain:"",onClick:F},{default:o(()=>[r("新增")]),_:1},8,["icon"])]),_:1}),w("div",ce,[e(m,{icon:a(z),circle:"",onClick:f},null,8,["icon"])])]),_:1}),w("div",pe,[Y((v(),V(I,{data:a(x),style:{width:"100%",height:"100%"},"row-key":"id"},{default:o(()=>[e(c,{prop:"name",label:"分类名称",width:"240"}),e(c,{prop:"desc",label:"描述",width:"150"}),e(c,{prop:"count",label:"文章数量","min-width":"150"}),e(c,{prop:"slug",label:"slug","min-width":"150"}),e(c,{prop:"thumbnail",label:"封面图","min-width":"80"},{default:o(t=>[t.row.thumbnail?(v(),V(G,{key:0,style:{width:"100%","max-height":"100%"},src:t.row.thumbnail,"zoom-rate":1.2,"max-scale":7,"min-scale":.2,"preview-src-list":[t.row.thumbnail],"initial-index":4,"append-to-body":"",fit:"cover","preview-teleported":""},null,8,["src","preview-src-list"])):Z("",!0)]),_:1}),e(c,{prop:"metaKeywords",label:"SEO关键字","min-width":"150"}),e(c,{prop:"metaDescription",label:"SEO描述","min-width":"150"}),e(c,{prop:"status",label:"状态",width:"80"},{default:o(t=>[t.row.status===0?(v(),V(A,{key:0,class:"ml-2",type:"success"},{default:o(()=>[r("正常")]),_:1})):(v(),V(A,{key:1,class:"ml-2",type:"danger"},{default:o(()=>[r("禁用")]),_:1}))]),_:1}),e(c,{label:"操作",width:"240",fixed:"right"},{default:o(t=>[e(m,{size:"small",type:"primary",link:"",icon:a(ee),onClick:E=>M(t.row)},{default:o(()=>[r("修改")]),_:2},1032,["icon","onClick"]),e(m,{size:"small",type:"primary",link:"",icon:a(B),onClick:E=>F(t.row)},{default:o(()=>[r("新增")]),_:2},1032,["icon","onClick"]),e(m,{size:"small",type:"primary",link:"",icon:a(le),onClick:E=>q(t.row)},{default:o(()=>[r("删除")]),_:2},1032,["icon","onClick"])]),_:1})]),_:1},8,["data"])),[[J,a(k)]])]),e(H,{modelValue:a(s),"onUpdate:modelValue":l[9]||(l[9]=t=>K(s)?s.value=t:s=t),title:a(C),width:"600px",draggable:""},{footer:o(()=>[w("span",fe,[e(m,{type:"primary",onClick:$},{default:o(()=>[r("确 定")]),_:1}),e(m,{onClick:l[8]||(l[8]=t=>{K(s)?s.value=!1:s=!1,g()})},{default:o(()=>[r("取 消")]),_:1})])]),default:o(()=>[e(U,{ref_key:"addFormRef",ref:y,model:a(n),"label-width":"100px","status-icon":"",rules:a(N)},{default:o(()=>[e(u,{label:"父级分类",prop:"pid"},{default:o(()=>[e(P,{modelValue:a(n).pid,"onUpdate:modelValue":l[1]||(l[1]=t=>a(n).pid=t),data:a(R),props:a(O),"check-strictly":"","render-after-expand":!1,style:{width:"100%"},clearable:""},null,8,["modelValue","data","props"])]),_:1}),e(u,{label:"分类名称",prop:"name"},{default:o(()=>[e(_,{modelValue:a(n).name,"onUpdate:modelValue":l[2]||(l[2]=t=>a(n).name=t),placeholder:"请输入分类名称"},null,8,["modelValue"])]),_:1}),e(u,{label:"分类描述",prop:"desc"},{default:o(()=>[e(_,{modelValue:a(n).desc,"onUpdate:modelValue":l[3]||(l[3]=t=>a(n).desc=t),placeholder:"请输入分类描述",autosize:{minRows:3,maxRows:6},type:"textarea"},null,8,["modelValue"])]),_:1}),e(u,{label:"分类slug",prop:"slug"},{default:o(()=>[e(_,{modelValue:a(n).slug,"onUpdate:modelValue":l[4]||(l[4]=t=>a(n).slug=t),placeholder:"请输入分类slug"},null,8,["modelValue"])]),_:1}),e(u,{label:"封面图",prop:"thumbnail"},{default:o(()=>[e(ae,{"attach-type":"img","enable-input":!0,placeholder:"请选择封面图","model-value":a(n).thumbnail,"onUpdate:modelValue":l[5]||(l[5]=t=>a(n).thumbnail=t)},null,8,["model-value"])]),_:1}),e(u,{label:"SEO关键字",prop:"metaKeywords"},{default:o(()=>[e(_,{modelValue:a(n).metaKeywords,"onUpdate:modelValue":l[6]||(l[6]=t=>a(n).metaKeywords=t),placeholder:"请输入SEO关键字",autosize:{minRows:3,maxRows:6},type:"textarea"},null,8,["modelValue"])]),_:1}),e(u,{label:"SEO描述内容",prop:"metaDescription"},{default:o(()=>[e(_,{modelValue:a(n).metaDescription,"onUpdate:modelValue":l[7]||(l[7]=t=>a(n).metaDescription=t),placeholder:"请输入SEO描述内容",autosize:{minRows:3,maxRows:6},type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}};export{ge as default};
