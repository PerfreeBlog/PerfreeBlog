import{r as g,P as X,a as i,y as Y,b as h,d as Z,e as _,f as e,w as t,u as l,z as ee,h as u,B as N,C as ae,D as te,k as b,t as P,J as le,a6 as ne,i as S,a7 as oe,N as ie,Q as se,j as re,T as ce,E as c,p as y,a8 as V}from"./index-DQCGZ03O.js";function ue(d){return axios.post("/api/auth/plugins/page",d)}function de(d){return axios.post("/api/auth/plugins/disablePlugin?id="+d)}function pe(d){return axios.post("/api/auth/plugins/enablePlugin?id="+d)}function _e(d){return axios.post("/api/auth/plugins/uninstallPlugin?id="+d)}const me={class:"page"},fe={class:"search-box"},ge={class:"right-tool"},he={class:"table-box"},be=["href"],we=_("div",{class:"el-upload__text"},[u(" 拖拽插件文件到此或"),_("em",null,"点击上传插件文件")],-1),ke=_("div",{class:"el-upload__tip"}," 插件文件为zip格式,若插件已存在,则会自动覆盖更新! ",-1),ye={__name:"PluginView",setup(d){const s=g({pageNo:1,pageSize:20,total:0,name:""}),x=g();let C=g([]),k=g(!1),f=g(!1),U=localStorage.getItem(X.STORAGE_TOKEN),E=ce.baseURL,R={Authorization:"Bearer "+JSON.parse(U).accessToken},v=g();function p(){k.value=!0,ue(s.value).then(o=>{C.value=o.data.list,s.value.total=o.data.total,k.value=!1})}function A(){s.value={name:""},x.value.resetFields()}function F(){f.value=!0}function D(o,a,w){o.code===200?(c.success("插件安装成功"),f.value=!1,v.value.clearFiles(),p()):(c.error(o.msg),v.value.handleRemove(a))}function O(o){c.error("插件上传失败,请检查网络是否通通畅")}function I(o){y.confirm("确定要禁用["+o.name+"]吗？","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(()=>{de(o.id).then(a=>{a.code===200&&a.data?(V().then(w=>{}),c.success("插件禁用成功"),p()):c.error(a.msg)})}).catch(()=>{})}function M(o){y.confirm("确定要启用["+o.name+"]吗？","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(()=>{pe(o.id).then(a=>{a.code===200&&a.data?(V().then(w=>{}),c.success("插件启用成功"),p()):c.error(a.msg)})}).catch(()=>{})}function j(o){y.confirm("确定要卸载["+o.name+"]吗？","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(()=>{_e(o.id).then(a=>{a.code===200?a.data?(c.success("插件卸载成功"),p()):c.error("插件卸载失败"):c.error(a.msg)})}).catch(()=>{})}return p(),(o,a)=>{const w=i("el-input"),T=i("el-form-item"),m=i("el-button"),J=i("el-form"),L=i("el-col"),$=i("el-row"),r=i("el-table-column"),z=i("el-tag"),G=i("el-table"),K=i("el-pagination"),Q=i("el-icon"),q=i("el-upload"),H=i("el-dialog"),W=Y("loading");return h(),Z("div",me,[_("div",fe,[e(J,{inline:!0,model:l(s),class:"demo-form-inline",ref_key:"searchFormRef",ref:x},{default:t(()=>[e(T,{label:"插件名称"},{default:t(()=>[e(w,{modelValue:l(s).name,"onUpdate:modelValue":a[0]||(a[0]=n=>l(s).name=n),placeholder:"请输入插件名称",clearable:""},null,8,["modelValue"])]),_:1}),e(T,null,{default:t(()=>[e(m,{type:"primary",onClick:p,icon:l(ee)},{default:t(()=>[u("查询")]),_:1},8,["icon"]),e(m,{icon:l(N),onClick:A},{default:t(()=>[u("重置")]),_:1},8,["icon"])]),_:1})]),_:1},8,["model"])]),e($,{gutter:10,class:"mb8"},{default:t(()=>[e(L,{span:1.5},{default:t(()=>[e(m,{icon:l(ae),type:"primary",plain:"",onClick:F},{default:t(()=>[u("安装插件")]),_:1},8,["icon"])]),_:1}),_("div",ge,[e(m,{icon:l(N),circle:"",onClick:p},null,8,["icon"])])]),_:1}),_("div",he,[te((h(),b(G,{data:l(C),style:{width:"100%",height:"100%"},"row-key":"id"},{default:t(()=>[e(r,{label:"序号","min-width":"80",type:"index"}),e(r,{prop:"name",label:"插件名称","min-width":"150"}),e(r,{prop:"desc",label:"描述信息","min-width":"200"}),e(r,{prop:"version",label:"版本","min-width":"80"}),e(r,{prop:"status",label:"状态",width:"100"},{default:t(n=>[n.row.status===1?(h(),b(z,{key:0,class:"ml-2",type:"success"},{default:t(()=>[u("已启用")]),_:1})):(h(),b(z,{key:1,class:"ml-2",type:"danger"},{default:t(()=>[u("已禁用")]),_:1}))]),_:1}),e(r,{prop:"author",label:"作者","min-width":"150"}),e(r,{prop:"website",label:"作者网站","min-width":"150"},{default:t(n=>[_("a",{href:n.row.website,target:"_blank"},P(n.row.website),9,be)]),_:1}),e(r,{prop:"email",label:"联系方式","min-width":"150"}),e(r,{prop:"createTime",label:"安装时间","min-width":"150"},{default:t(n=>[_("span",null,P(l(le)(n.row.createTime)),1)]),_:1}),e(r,{label:"操作",width:"140",fixed:"right"},{default:t(n=>[n.row.status===0?(h(),b(m,{key:0,size:"small",type:"primary",link:"",icon:l(ne),onClick:B=>M(n.row)},{default:t(()=>[u("启用")]),_:2},1032,["icon","onClick"])):S("",!0),n.row.status===1?(h(),b(m,{key:1,size:"small",type:"primary",link:"",icon:l(oe),onClick:B=>I(n.row)},{default:t(()=>[u("禁用")]),_:2},1032,["icon","onClick"])):S("",!0),e(m,{size:"small",type:"primary",link:"",icon:l(ie),onClick:B=>j(n.row)},{default:t(()=>[u("卸载")]),_:2},1032,["icon","onClick"])]),_:1})]),_:1},8,["data"])),[[W,l(k)]]),e(K,{"current-page":l(s).pageNo,"onUpdate:currentPage":a[1]||(a[1]=n=>l(s).pageNo=n),"page-size":l(s).pageSize,"onUpdate:pageSize":a[2]||(a[2]=n=>l(s).pageSize=n),"page-sizes":[10,20,30,50],layout:"total,sizes,prev, pager, next, jumper",background:"",small:"",onChange:p,total:l(s).total},null,8,["current-page","page-size","total"])]),e(H,{modelValue:l(f),"onUpdate:modelValue":a[3]||(a[3]=n=>re(f)?f.value=n:f=n),title:"安装插件",width:"500px",draggable:""},{default:t(()=>[e(q,{class:"upload-demo",drag:"",ref_key:"uploadRef",ref:v,accept:"application/zip","on-success":D,"on-error":O,headers:l(R),action:l(E)+"/api/auth/plugins/installPlugin"},{tip:t(()=>[ke]),default:t(()=>[e(Q,{class:"el-icon--upload"},{default:t(()=>[e(l(se))]),_:1}),we]),_:1},8,["headers","action"])]),_:1},8,["modelValue"])])}}};export{ye as default};
