import{V as $,ap as P,aX as O,aY as A,aZ as I,v as T,a_ as _,W as k,U as w,B as R,a$ as q,am as F,b0 as z,$ as W,aj as X,b1 as Y,r as B,k as S,o as Z,P as M,a6 as D}from"./index-CihRDGxx.js";import{_ as L}from"./el-tree-HJbZURUt.js";const G=(e,{attrs:c,emit:d},{select:o,tree:s,key:n})=>{const u=$("tree-select");return P(()=>e.data,()=>{e.filterable&&O(()=>{var t,h;(h=s.value)==null||h.filter((t=o.value)==null?void 0:t.states.inputValue)})},{flush:"post"}),{...A(I(e),Object.keys(T.props)),...c,"onUpdate:modelValue":t=>d(_,t),valueKey:n,popperClass:k(()=>{const t=[u.e("popper")];return e.popperClass&&t.push(e.popperClass),t.join(" ")}),filterMethod:(t="")=>{var h;e.filterMethod?e.filterMethod(t):e.remoteMethod?e.remoteMethod(t):(h=s.value)==null||h.filter(t)}}},J=w({extends:R,setup(e,c){const d=R.setup(e,c);delete d.selectOptionClick;const o=q().proxy;return O(()=>{d.select.states.cachedOptions.get(o.value)||d.select.onOptionCreate(o)}),d},methods:{selectOptionClick(){this.$el.parentElement.click()}}});function j(e){return e||e===0}function H(e){return Array.isArray(e)&&e.length}function g(e){return Array.isArray(e)?e:j(e)?[e]:[]}function E(e,c,d,o,s){for(let n=0;n<e.length;n++){const u=e[n];if(c(u,n,e,s))return o?o(u,n,e,s):u;{const C=d(u);if(H(C)){const t=E(C,c,d,o,u);if(t)return t}}}}function p(e,c,d,o){for(let s=0;s<e.length;s++){const n=e[s];c(n,s,e,o);const u=d(n);H(u)&&p(u,c,d,n)}}const Q=(e,{attrs:c,slots:d,emit:o},{select:s,tree:n,key:u})=>{P(()=>e.modelValue,()=>{e.showCheckbox&&O(()=>{const l=n.value;l&&!F(l.getCheckedKeys(),g(e.modelValue))&&l.setCheckedKeys(g(e.modelValue))})},{immediate:!0,deep:!0});const C=k(()=>({value:u.value,label:"label",children:"children",disabled:"disabled",isLeaf:"isLeaf",...e.props})),t=(l,a)=>{var i;const r=C.value[l];return W(r)?r(a,(i=n.value)==null?void 0:i.getNode(t("value",a))):a[r]},h=g(e.modelValue).map(l=>E(e.data||[],a=>t("value",a)===l,a=>t("children",a),(a,i,r,v)=>v&&t("value",v))).filter(l=>j(l)),b=k(()=>{if(!e.renderAfterExpand&&!e.lazy)return[];const l=[];return p(e.data.concat(e.cacheData),a=>{const i=t("value",a);l.push({value:i,currentLabel:t("label",a),isDisabled:t("disabled",a)})},a=>t("children",a)),l});return{...A(I(e),Object.keys(L.props)),...c,nodeKey:u,expandOnClickNode:k(()=>!e.checkStrictly&&e.expandOnClickNode),defaultExpandedKeys:k(()=>e.defaultExpandedKeys?e.defaultExpandedKeys.concat(h):h),renderContent:(l,{node:a,data:i,store:r})=>l(J,{value:t("value",i),label:t("label",i),disabled:t("disabled",i)},e.renderContent?()=>e.renderContent(l,{node:a,data:i,store:r}):d.default?()=>d.default({node:a,data:i,store:r}):void 0),filterNodeMethod:(l,a,i)=>e.filterNodeMethod?e.filterNodeMethod(l,a,i):l?new RegExp(z(l),"i").test(t("label",a)||""):!0,onNodeClick:(l,a,i)=>{var r,v,m,K;if((r=c.onNodeClick)==null||r.call(c,l,a,i),!(e.showCheckbox&&e.checkOnClickNode)){if(!e.showCheckbox&&(e.checkStrictly||a.isLeaf)){if(!t("disabled",l)){const N=(v=s.value)==null?void 0:v.states.options.get(t("value",l));(m=s.value)==null||m.handleOptionSelect(N)}}else e.expandOnClickNode&&i.proxy.handleExpandIconClick();(K=s.value)==null||K.focus()}},onCheck:(l,a)=>{var i;if(!e.showCheckbox)return;const r=t("value",l),v={};p([n.value.store.root],f=>v[f.key]=f,f=>f.childNodes);const m=a.checkedKeys,K=e.multiple?g(e.modelValue).filter(f=>!(f in v)&&!m.includes(f)):[],N=K.concat(m);if(e.checkStrictly)o(_,e.multiple?N:N.includes(r)?r:void 0);else if(e.multiple)o(_,K.concat(n.value.getCheckedKeys(!0)));else{const f=E([l],y=>!H(t("children",y))&&!t("disabled",y),y=>t("children",y)),x=f?t("value",f):void 0,U=j(e.modelValue)&&!!E([l],y=>t("value",y)===e.modelValue,y=>t("children",y));o(_,x===e.modelValue||U?void 0:x)}O(()=>{var f;const x=g(e.modelValue);n.value.setCheckedKeys(x),(f=c.onCheck)==null||f.call(c,l,{checkedKeys:n.value.getCheckedKeys(),checkedNodes:n.value.getCheckedNodes(),halfCheckedKeys:n.value.getHalfCheckedKeys(),halfCheckedNodes:n.value.getHalfCheckedNodes()})}),(i=s.value)==null||i.focus()},cacheOptions:b}};var ee=w({props:{data:{type:Array,default:()=>[]}},setup(e){const c=X(Y);return P(()=>e.data,()=>{var d;e.data.forEach(s=>{c.states.cachedOptions.has(s.value)||c.states.cachedOptions.set(s.value,s)});const o=((d=c.selectRef)==null?void 0:d.querySelectorAll("input"))||[];Array.from(o).includes(document.activeElement)||c.setSelected()},{flush:"post",immediate:!0}),()=>{}}});const te=w({name:"ElTreeSelect",inheritAttrs:!1,props:{...T.props,...L.props,cacheData:{type:Array,default:()=>[]}},setup(e,c){const{slots:d,expose:o}=c,s=B(),n=B(),u=k(()=>e.nodeKey||e.valueKey||"value"),C=G(e,c,{select:s,tree:n,key:u}),{cacheOptions:t,...h}=Q(e,c,{select:s,tree:n,key:u}),b=S({});return o(b),Z(()=>{Object.assign(b,{...A(n.value,["filter","updateKeyChildren","getCheckedNodes","setCheckedNodes","getCheckedKeys","setCheckedKeys","setChecked","getHalfCheckedNodes","getHalfCheckedKeys","getCurrentKey","getCurrentNode","setCurrentKey","setCurrentNode","getNode","remove","append","insertBefore","insertAfter"]),...A(s.value,["focus","blur"])})}),()=>M(T,S({...C,ref:l=>s.value=l}),{...d,default:()=>[M(ee,{data:t.value}),M(L,S({...h,ref:l=>n.value=l}))]})}});var V=D(te,[["__file","tree-select.vue"]]);V.install=e=>{e.component(V.name,V)};const le=V,ce=le;export{ce as E};
