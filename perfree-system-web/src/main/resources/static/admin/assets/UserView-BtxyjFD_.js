import{d as se}from"./role-DFWIJcAV.js";import{r as p,l as ue,a as m,y as re,b as V,d as M,e as y,f as l,w as o,u as a,z as ne,h as c,B as $,C as ie,D as de,k as N,t as pe,J as me,M as ce,a3 as fe,ac as _e,N as ge,j as R,F as ve,m as be,i as we,p as q,E as v}from"./index-DQCGZ03O.js";function he(r){return axios.post("/api/auth/user/page",r)}function Ve(r){return axios.get("/api/auth/user/get?id="+r)}function ye(r){return axios.post("/api/auth/user/add",r)}function ke(r){return axios.post("/api/auth/user/update",r)}function xe(r){return axios.delete("/api/auth/user/del?id="+r)}function Ne(r){return axios.post("/api/auth/user/updateUserRole",r)}function Ue(r){return axios.get("/api/auth/user/getUserRole?id="+r)}function Ce(r){return axios.post("/api/auth/user/resetPassword",r)}const Re={class:"page"},Fe={class:"search-box"},ze={class:"right-tool"},Ae={class:"table-box"},Be={class:"dialog-footer"},Te={class:"dialog-footer"},Se={__name:"UserView",setup(r){const i=p({pageNo:1,pageSize:20,total:0,userName:"",account:""}),u=p({id:"",userName:"",account:"",password:"",email:"",website:""}),d=p({id:"",userName:"",account:"",roles:""}),j=ue({userName:[{required:!0,message:"请输入昵称",trigger:"blur"},{min:2,max:20,message:"昵称必须在2-20字之间",trigger:"blur"}],account:[{required:!0,message:"请输入账户",trigger:"blur"},{min:5,max:16,message:"账户必须在5-16字之间",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:5,max:16,message:"密码必须在5-16字之间",trigger:"blur"}]}),P=p(),U=p(),C=p();let _=p(!1),b=p(!1),k=p(""),D=p([]),F=p(!1),z=p(!1),S=p([]);function J(s){q.prompt("请输入["+s.userName+"]的新密码","提示",{confirmButtonText:"确认",cancelButtonText:"取消",inputValidator:O,inputPlaceholder:"请输入新密码",inputErrorMessage:"请输入新密码"}).then(({value:e})=>{Ce({id:s.id,password:e}).then(n=>{n.code===200?v.success("重置成功"):v.error(n.msg)})}).catch(()=>{})}function O(s){return s}function G(){C.value.validate(s=>{s&&Ne(d.value).then(e=>{e.code===200?(v.success("操作成功"),b.value=!1,A(),w()):v.error(e.msg)})})}function A(){d.value={id:"",userName:"",account:"",roles:""},C.value&&C.value.resetFields()}function H(){U.value.validate(s=>{s&&(u.value.id?(u.value.password=null,ke(u.value).then(e=>{e.code===200?(v.success("更新成功"),_.value=!1,x(),w()):v.error(e.msg)})):ye(u.value).then(e=>{e.code===200?(v.success("添加成功"),_.value=!1,x(),w()):v.error(e.msg)}))})}function I(){x(),k.value="添加用户",_.value=!0,z.value=!1}function K(s){x(),k.value="修改用户",_.value=!0,z.value=!0,Ve(s.id).then(e=>{u.value=e.data,u.value.password=""})}function Q(s){q.confirm("确定要删除["+s.userName+"]吗？","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(()=>{xe(s.id).then(e=>{e.code===200&&e.data?(v.success("删除成功"),w()):v.error(e.msg)})}).catch(()=>{})}function w(){F.value=!0,he(i.value).then(s=>{D.value=s.data.list,i.value.total=s.data.total,F.value=!1})}function W(){i.value={userName:"",account:""},P.value.resetFields()}function x(){u.value={id:"",userName:"",account:"",password:"",email:"",website:""},U.value&&U.value.resetFields()}function X(s){A(),d.value.id=s.id,d.value.userName=s.userName,d.value.account=s.account,se().then(e=>{S.value=e.data,Ue(s.id).then(n=>{d.value.roles=n.data.roles})}),k.value="分配角色",b.value=!0}return w(),(s,e)=>{const n=m("el-input"),g=m("el-form-item"),f=m("el-button"),B=m("el-form"),Y=m("el-col"),Z=m("el-row"),h=m("el-table-column"),E=m("el-tag"),ee=m("el-table"),le=m("el-pagination"),ae=m("el-option"),te=m("el-select"),L=m("el-dialog"),oe=re("loading");return V(),M("div",Re,[y("div",Fe,[l(B,{inline:!0,model:a(i),class:"demo-form-inline",ref_key:"searchFormRef",ref:P},{default:o(()=>[l(g,{label:"昵称"},{default:o(()=>[l(n,{modelValue:a(i).userName,"onUpdate:modelValue":e[0]||(e[0]=t=>a(i).userName=t),placeholder:"请输入昵称",clearable:""},null,8,["modelValue"])]),_:1}),l(g,{label:"账户"},{default:o(()=>[l(n,{modelValue:a(i).account,"onUpdate:modelValue":e[1]||(e[1]=t=>a(i).account=t),placeholder:"请输入账户",clearable:""},null,8,["modelValue"])]),_:1}),l(g,null,{default:o(()=>[l(f,{type:"primary",onClick:w,icon:a(ne)},{default:o(()=>[c("查询")]),_:1},8,["icon"]),l(f,{icon:a($),onClick:W},{default:o(()=>[c("重置")]),_:1},8,["icon"])]),_:1})]),_:1},8,["model"])]),l(Z,{gutter:10,class:"mb8"},{default:o(()=>[l(Y,{span:1.5},{default:o(()=>[l(f,{icon:a(ie),type:"primary",plain:"",onClick:I},{default:o(()=>[c("新增")]),_:1},8,["icon"])]),_:1}),y("div",ze,[l(f,{icon:a($),circle:"",onClick:w},null,8,["icon"])])]),_:1}),y("div",Ae,[de((V(),N(ee,{data:a(D),style:{width:"100%",height:"100%"},"row-key":"id"},{default:o(()=>[l(h,{label:"序号","min-width":"80",type:"index"}),l(h,{prop:"userName",label:"用户名称","min-width":"150"}),l(h,{prop:"account",label:"账号","min-width":"150"}),l(h,{prop:"status",label:"状态","min-width":"100"},{default:o(t=>[t.row.status===0?(V(),N(E,{key:0,class:"ml-2",type:"success"},{default:o(()=>[c("开启")]),_:1})):(V(),N(E,{key:1,class:"ml-2",type:"danger"},{default:o(()=>[c("关闭")]),_:1}))]),_:1}),l(h,{prop:"email",label:"邮箱","min-width":"150"}),l(h,{prop:"website",label:"网站","min-width":"150"}),l(h,{prop:"createTime",label:"创建时间","min-width":"120"},{default:o(t=>[y("span",null,pe(a(me)(t.row.createTime)),1)]),_:1}),l(h,{label:"操作",width:"300",fixed:"right"},{default:o(t=>[l(f,{size:"small",type:"primary",link:"",icon:a(ce),onClick:T=>K(t.row)},{default:o(()=>[c("修改")]),_:2},1032,["icon","onClick"]),l(f,{size:"small",type:"primary",link:"",icon:a(fe),onClick:T=>X(t.row)},{default:o(()=>[c("分配角色")]),_:2},1032,["icon","onClick"]),l(f,{size:"small",type:"primary",link:"",icon:a(_e),onClick:T=>J(t.row)},{default:o(()=>[c("重置密码")]),_:2},1032,["icon","onClick"]),l(f,{size:"small",type:"primary",link:"",icon:a(ge),onClick:T=>Q(t.row)},{default:o(()=>[c("删除")]),_:2},1032,["icon","onClick"])]),_:1})]),_:1},8,["data"])),[[oe,a(F)]]),l(le,{"current-page":a(i).pageNo,"onUpdate:currentPage":e[2]||(e[2]=t=>a(i).pageNo=t),"page-size":a(i).pageSize,"onUpdate:pageSize":e[3]||(e[3]=t=>a(i).pageSize=t),"page-sizes":[10,20,30,50],layout:"total,sizes,prev, pager, next, jumper",background:"",small:"",onChange:w,total:a(i).total},null,8,["current-page","page-size","total"])]),l(L,{modelValue:a(b),"onUpdate:modelValue":e[8]||(e[8]=t=>R(b)?b.value=t:b=t),title:a(k),width:"600px",draggable:""},{footer:o(()=>[y("span",Be,[l(f,{type:"primary",onClick:G},{default:o(()=>[c("确 定")]),_:1}),l(f,{onClick:e[7]||(e[7]=t=>{R(b)?b.value=!1:b=!1,A()})},{default:o(()=>[c("取 消")]),_:1})])]),default:o(()=>[l(B,{ref_key:"userRoleFormRef",ref:C,model:a(d),"label-width":"80px","status-icon":""},{default:o(()=>[l(g,{label:"昵称",prop:"userName"},{default:o(()=>[l(n,{modelValue:a(d).userName,"onUpdate:modelValue":e[4]||(e[4]=t=>a(d).userName=t),disabled:"",placeholder:"请输入昵称"},null,8,["modelValue"])]),_:1}),l(g,{label:"账户",prop:"account"},{default:o(()=>[l(n,{modelValue:a(d).account,"onUpdate:modelValue":e[5]||(e[5]=t=>a(d).account=t),disabled:"",placeholder:"请输入账户"},null,8,["modelValue"])]),_:1}),l(g,{label:"角色",prop:"roles"},{default:o(()=>[l(te,{modelValue:a(d).roles,"onUpdate:modelValue":e[6]||(e[6]=t=>a(d).roles=t),clearable:"",multiple:"",placeholder:"请选择角色",style:{width:"100%"}},{default:o(()=>[(V(!0),M(ve,null,be(a(S),t=>(V(),N(ae,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(L,{modelValue:a(_),"onUpdate:modelValue":e[15]||(e[15]=t=>R(_)?_.value=t:_=t),title:a(k),width:"600px",draggable:""},{footer:o(()=>[y("span",Te,[l(f,{type:"primary",onClick:H},{default:o(()=>[c("确 定")]),_:1}),l(f,{onClick:e[14]||(e[14]=t=>{R(_)?_.value=!1:_=!1,x()})},{default:o(()=>[c("取 消")]),_:1})])]),default:o(()=>[l(B,{ref_key:"addFormRef",ref:U,model:a(u),"label-width":"60px","status-icon":"",rules:a(j)},{default:o(()=>[l(g,{label:"昵称",prop:"userName"},{default:o(()=>[l(n,{modelValue:a(u).userName,"onUpdate:modelValue":e[9]||(e[9]=t=>a(u).userName=t),placeholder:"请输入昵称"},null,8,["modelValue"])]),_:1}),l(g,{label:"账户",prop:"account"},{default:o(()=>[l(n,{modelValue:a(u).account,"onUpdate:modelValue":e[10]||(e[10]=t=>a(u).account=t),placeholder:"请输入账户"},null,8,["modelValue"])]),_:1}),a(z)?we("",!0):(V(),N(g,{key:0,label:"密码",prop:"password"},{default:o(()=>[l(n,{modelValue:a(u).password,"onUpdate:modelValue":e[11]||(e[11]=t=>a(u).password=t),type:"password","show-password":"",placeholder:"请输入密码"},null,8,["modelValue"])]),_:1})),l(g,{label:"邮箱",prop:"email"},{default:o(()=>[l(n,{modelValue:a(u).email,"onUpdate:modelValue":e[12]||(e[12]=t=>a(u).email=t),placeholder:"请输入邮箱地址"},null,8,["modelValue"])]),_:1}),l(g,{label:"网站",prop:"website"},{default:o(()=>[l(n,{modelValue:a(u).website,"onUpdate:modelValue":e[13]||(e[13]=t=>a(u).website=t),placeholder:"请输入网站地址"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}};export{Se as default};
