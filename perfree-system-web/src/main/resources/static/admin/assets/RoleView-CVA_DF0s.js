import{r as s,k as ae,a as O,b as oe,d as g,e as l,w as t,u as a,C as te,f as p,D as j,G as ne,H as S,j as de,t as se,N as ie,aE as re,O as ue,i as E,m as b,q as me,s as pe,E as ce,y as fe}from"./index-CihRDGxx.js";import{E as _e,a as ve,v as ge}from"./el-table-column-CTu-3kzb.js";import"./el-dialog-DFE0lXHY.js";import{E as be}from"./el-tree-HJbZURUt.js";import{p as he,h as ke,E as Ve}from"./perfree-nhCXPnWy.js";import{E as ye}from"./el-pagination-DVMT5liM.js";import{E as xe,a as Ee}from"./el-col-BEhwhFzy.js";import{e as Ce,g as we,f as Fe}from"./menu-Zv2FujxN.js";import{r as Ae,a as Re,b as Te,c as Ue}from"./role-DFWIJcAV.js";import{E as ze}from"./index-DVZG1lLp.js";import{E as Me}from"./index-uh3ESdbA.js";const Be={class:"page"},De={class:"search-box"},Ne={class:"right-tool"},Oe={class:"table-box"},je={style:{width:"100%",border:"1px solid rgb(228 231 237)",padding:"5px"}},Se={class:"dialog-footer"},Ie={class:"dialog-footer"},Ze={__name:"RoleView",setup(Le){let T=s([]);const I={children:"children",label:"name"},i=s({pageNo:1,pageSize:20,total:0,name:""}),d=s({id:"",name:"",code:"",expand:!1,selectAll:!1}),u=s({id:"",name:"",code:"",description:""}),L=ae({name:[{required:!0,message:"请输入角色名称",trigger:"blur"}],code:[{required:!0,message:"请输入角色编码",trigger:"blur"}]}),f=s(),U=s(),y=s(),C=s();let c=s(!1),m=s(!1),k=s(""),z=s([]),w=s(!1),F=s(!1);function P(){y.value.validate(n=>{n&&Ae(u.value).then(e=>{e.code===200?(b.success("操作成功"),m.value=!1,x(),h()):b.error(e.msg)})})}function q(){x(),k.value="添加角色",m.value=!0}function K(n){x(),k.value="修改角色",m.value=!0,Re(n.id).then(e=>{u.value=e.data})}function $(n){ze.confirm("确定要删除["+n.name+"]吗？","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(()=>{Te(n.id).then(e=>{e.code===200&&e.data?(b.success("删除成功"),h()):b.error(e.msg)})}).catch(()=>{})}function h(){w.value=!0,Ue(i.value).then(n=>{z.value=n.data.list,i.value.total=n.data.total,w.value=!1})}function G(){i.value={name:""},U.value.resetFields()}function x(){u.value={id:"",name:"",code:"",description:""},y.value&&y.value.resetFields()}function A(){d.value={id:"",name:"",code:"",expand:!1,selectAll:!1},C.value&&C.value.resetFields()}function H(n){if(n.code==="admin"){b.warning("admin角色默认拥有所有权限,不可修改");return}A(),c.value=!0,d.value.name=n.name,d.value.code=n.code,d.value.id=n.id,k.value="菜单权限",F.value=!0,Ce({}).then(e=>{T.value=ke(e.data,"id","pid","children","-1"),we(n.id).then(_=>{f.value.setCheckedKeys(_.data),F.value=!1})})}function J(){d.value.expand?Object.values(f.value.store.nodesMap).forEach(n=>n.expand()):Object.values(f.value.store.nodesMap).forEach(n=>n.collapse())}function Q(){d.value.selectAll?Object.values(f.value.store.nodesMap).forEach(n=>{n.checked=!0}):Object.values(f.value.store.nodesMap).forEach(n=>{n.checked=!1})}function W(){let n={menuIds:[...f.value.getCheckedKeys(),...f.value.getHalfCheckedKeys()],roleId:d.value.id};Fe(n).then(e=>{e.code===200&&e.data?(b.success("操作成功"),c.value=!1,A()):b.error(e.msg)})}return h(),(n,e)=>{const _=me,v=pe,r=ce,R=fe,X=xe,Y=Ee,V=_e,Z=ve,ee=ye,M=Ve,le=be,B=Me,D=ge;return O(),oe("div",Be,[g("div",De,[l(R,{inline:!0,model:a(i),class:"demo-form-inline",ref_key:"searchFormRef",ref:U},{default:t(()=>[l(v,{label:"角色名称"},{default:t(()=>[l(_,{modelValue:a(i).name,"onUpdate:modelValue":e[0]||(e[0]=o=>a(i).name=o),placeholder:"请输入角色名称",clearable:""},null,8,["modelValue"])]),_:1}),l(v,null,{default:t(()=>[l(r,{type:"primary",onClick:h,icon:a(te)},{default:t(()=>[p("查询")]),_:1},8,["icon"]),l(r,{icon:a(j),onClick:G},{default:t(()=>[p("重置")]),_:1},8,["icon"])]),_:1})]),_:1},8,["model"])]),l(Y,{gutter:10,class:"mb8"},{default:t(()=>[l(X,{span:1.5},{default:t(()=>[l(r,{icon:a(ne),type:"primary",plain:"",onClick:q},{default:t(()=>[p("新增")]),_:1},8,["icon"])]),_:1}),g("div",Ne,[l(r,{icon:a(j),circle:"",onClick:h},null,8,["icon"])])]),_:1}),g("div",Oe,[S((O(),de(Z,{data:a(z),style:{width:"100%",height:"100%"},"row-key":"id"},{default:t(()=>[l(V,{prop:"name",label:"角色名称","min-width":"150"}),l(V,{prop:"code",label:"角色编码","min-width":"150"}),l(V,{prop:"description",label:"描述","min-width":"240"}),l(V,{prop:"createTime",label:"创建时间","min-width":"120"},{default:t(o=>[g("span",null,se(a(he)(o.row.createTime)),1)]),_:1}),l(V,{label:"操作",width:"240",fixed:"right"},{default:t(o=>[l(r,{size:"small",type:"primary",link:"",icon:a(ie),onClick:N=>K(o.row)},{default:t(()=>[p("修改")]),_:2},1032,["icon","onClick"]),l(r,{size:"small",type:"primary",link:"",icon:a(re),onClick:N=>H(o.row)},{default:t(()=>[p("菜单权限 ")]),_:2},1032,["icon","onClick"]),l(r,{size:"small",type:"primary",link:"",icon:a(ue),onClick:N=>$(o.row)},{default:t(()=>[p("删除")]),_:2},1032,["icon","onClick"])]),_:1})]),_:1},8,["data"])),[[D,a(w)]]),l(ee,{"current-page":a(i).pageNo,"onUpdate:currentPage":e[1]||(e[1]=o=>a(i).pageNo=o),"page-size":a(i).pageSize,"onUpdate:pageSize":e[2]||(e[2]=o=>a(i).pageSize=o),"page-sizes":[10,20,30,50],layout:"total,sizes,prev, pager, next, jumper",background:"",small:"",onChange:h,total:a(i).total},null,8,["current-page","page-size","total"])]),l(B,{modelValue:a(c),"onUpdate:modelValue":e[8]||(e[8]=o=>E(c)?c.value=o:c=o),title:a(k),width:"600px",draggable:""},{footer:t(()=>[g("span",Se,[l(r,{type:"primary",onClick:W},{default:t(()=>[p("确 定")]),_:1}),l(r,{onClick:e[7]||(e[7]=o=>{E(c)?c.value=!1:c=!1,A()})},{default:t(()=>[p("取 消")]),_:1})])]),default:t(()=>[l(R,{ref_key:"menuFormRef",ref:C,model:a(d),"label-width":"80px",class:"demo-ruleForm","status-icon":""},{default:t(()=>[l(v,{label:"角色名称",prop:"name"},{default:t(()=>[l(_,{modelValue:a(d).name,"onUpdate:modelValue":e[3]||(e[3]=o=>a(d).name=o),disabled:""},null,8,["modelValue"])]),_:1}),l(v,{label:"角色编码",prop:"code"},{default:t(()=>[l(_,{modelValue:a(d).code,"onUpdate:modelValue":e[4]||(e[4]=o=>a(d).code=o),disabled:""},null,8,["modelValue"])]),_:1}),l(v,{label:"菜单权限",prop:"code"},{default:t(()=>[l(M,{modelValue:a(d).expand,"onUpdate:modelValue":e[5]||(e[5]=o=>a(d).expand=o),label:"展开/折叠",onChange:J},null,8,["modelValue"]),l(M,{modelValue:a(d).selectAll,"onUpdate:modelValue":e[6]||(e[6]=o=>a(d).selectAll=o),label:"全选/全不选",onChange:Q},null,8,["modelValue"]),g("div",je,[S(l(le,{props:I,data:a(T),"node-key":"id","show-checkbox":"",ref_key:"menuTree",ref:f,"check-strictly":!0},null,8,["data"]),[[D,a(F)]])])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(B,{modelValue:a(m),"onUpdate:modelValue":e[13]||(e[13]=o=>E(m)?m.value=o:m=o),title:a(k),width:"600px",draggable:""},{footer:t(()=>[g("span",Ie,[l(r,{type:"primary",onClick:P},{default:t(()=>[p("确 定")]),_:1}),l(r,{onClick:e[12]||(e[12]=o=>{E(m)?m.value=!1:m=!1,x()})},{default:t(()=>[p("取 消")]),_:1})])]),default:t(()=>[l(R,{ref_key:"addFormRef",ref:y,model:a(u),"label-width":"80px","status-icon":"",rules:a(L)},{default:t(()=>[l(v,{label:"角色名称",prop:"name"},{default:t(()=>[l(_,{modelValue:a(u).name,"onUpdate:modelValue":e[9]||(e[9]=o=>a(u).name=o),placeholder:"请输入角色名称"},null,8,["modelValue"])]),_:1}),l(v,{label:"角色编码",prop:"code"},{default:t(()=>[l(_,{modelValue:a(u).code,"onUpdate:modelValue":e[10]||(e[10]=o=>a(u).code=o),placeholder:"请输入角色编码"},null,8,["modelValue"])]),_:1}),l(v,{label:"描述",prop:"description"},{default:t(()=>[l(_,{modelValue:a(u).description,"onUpdate:modelValue":e[11]||(e[11]=o=>a(u).description=o),placeholder:"请输入角色描述",autosize:{minRows:3,maxRows:6},type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}};export{Ze as default};
