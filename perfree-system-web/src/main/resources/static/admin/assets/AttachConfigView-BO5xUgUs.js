import{r as _,k as X,a as n,b as x,d as h,e as o,w as s,u as e,C as Y,f as u,D as z,G as Z,H as ee,j as c,h as f,t as ae,N as le,aB as te,O as oe,i as K,m as k,q as se,s as re,E as ne,y as de,Q as ie,v as ue,B as ce}from"./index-DAZg6KgI.js";import{E as me,a as pe,v as fe}from"./el-table-column-DZMpWYo5.js";import"./el-dialog-Cx6vfFNe.js";/* empty css                */import{E as ge}from"./el-pagination-x5Aplci8.js";import{p as _e}from"./perfree-h22k_lv_.js";import{E as be,a as ke}from"./el-col-Y4mM9eD_.js";import{a as ye,b as ve,c as he,d as Ve,e as Ce,f as Ee}from"./attachConfig-C4U5uJ4c.js";import{E as P}from"./index-DNxUcOTo.js";import{E as we}from"./index-D_wX2Lgc.js";import{E as Se}from"./index-AgTUDQsJ.js";const xe={class:"page"},Ue={class:"search-box"},De={class:"right-tool"},Fe={class:"table-box"},Ae={key:0},Be={key:1},Te={class:"dialog-footer"},Le={__name:"AttachConfigView",setup(ze){let U=_([]),E=_(!1);const D=_();let m=_(!1),V=_(!1),w=_("");const C=_(),a=_({id:"",name:"",remark:"",storage:void 0,basePath:"",endpoint:"",bucket:"",accessKey:"",accessSecret:"",domain:"",uploadDir:""}),N=X({name:[{required:!0,message:"请输入配置名称",trigger:"blur"}],storage:[{required:!0,message:"请选择存储器类型",trigger:"blur"}],basePath:[{required:!0,message:"请输入存储路径",trigger:"blur"}],endpoint:[{required:!0,message:"请输入节点地址",trigger:"blur"}],bucket:[{required:!0,message:"请输入存储bucket",trigger:"blur"}],accessKey:[{required:!0,message:"请输入accessKey",trigger:"blur"}],accessSecret:[{required:!0,message:"请输入accessSecret",trigger:"blur"}]}),p=_({pageNo:1,pageSize:20,total:0,name:""});function b(){E.value=!0,ye(p.value).then(d=>{U.value=d.data.list,p.value.total=d.data.total,E.value=!1})}function q(){p.value={name:""},D.value.resetFields()}function R(){V.value=!1,w.value="新增配置",v(),m.value=!0}function v(){a.value={id:"",name:"",remark:"",storage:void 0,basePath:"",endpoint:"",bucket:"",accessKey:"",accessSecret:"",domain:"",uploadDir:""},C.value&&C.value.resetFields()}function O(){C.value.validate(d=>{if(d){let l;a.value.storage===0?l={basePath:a.value.basePath}:l={endpoint:a.value.endpoint,bucket:a.value.bucket,accessKey:a.value.accessKey,accessSecret:a.value.accessSecret,domain:a.value.domain,uploadDir:a.value.uploadDir};const i={id:a.value.id,name:a.value.name,remark:a.value.remark,storage:a.value.storage,config:JSON.stringify(l)};a.value.id?ve(i).then(r=>{r.code===200?(k.success("修改成功"),m.value=!1,v(),b()):k.error(r.msg)}):he(i).then(r=>{r.code===200?(k.success("添加成功"),m.value=!1,v(),b()):k.error(r.msg)})}})}function M(d){if(d.master){k.error("默认配置不允许删除!");return}P.confirm("确定要删除["+d.name+"]吗？删除后该配置内上传的文件将无法展示!","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(()=>{Ve(d.id).then(l=>{l.code===200&&l.data?(k.success("删除成功"),b()):k.error(l.msg)})}).catch(()=>{})}function j(d){V.value=!0,w.value="修改配置",v(),m.value=!0,Ce(d.id).then(l=>{a.value=Object.assign(l.data,JSON.parse(l.data.config))})}function $(d){P.confirm("确定要将除["+d.name+"]设置为主配置吗？","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(()=>{Ee({id:d.id}).then(l=>{k.success("修改成功"),b()})}).catch(()=>{})}return b(),(d,l)=>{const i=se,r=re,g=ne,F=de,I=be,J=ke,y=me,A=ie,L=pe,G=ge,B=ce,H=ue,S=we,Q=Se,W=fe;return n(),x("div",xe,[h("div",Ue,[o(F,{inline:!0,model:e(p),class:"demo-form-inline",ref_key:"searchFormRef",ref:D},{default:s(()=>[o(r,{label:"配置名称"},{default:s(()=>[o(i,{modelValue:e(p).name,"onUpdate:modelValue":l[0]||(l[0]=t=>e(p).name=t),placeholder:"请输入配置名称",clearable:""},null,8,["modelValue"])]),_:1}),o(r,null,{default:s(()=>[o(g,{type:"primary",onClick:b,icon:e(Y)},{default:s(()=>[u("查询")]),_:1},8,["icon"]),o(g,{icon:e(z),onClick:q},{default:s(()=>[u("重置")]),_:1},8,["icon"])]),_:1})]),_:1},8,["model"])]),o(J,{gutter:10,class:"mb8"},{default:s(()=>[o(I,{span:1.5},{default:s(()=>[o(g,{icon:e(Z),type:"primary",plain:"",onClick:R},{default:s(()=>[u("新增")]),_:1},8,["icon"])]),_:1}),h("div",De,[o(g,{icon:e(z),circle:"",onClick:b},null,8,["icon"])])]),_:1}),h("div",Fe,[ee((n(),c(L,{data:e(U),style:{width:"100%",height:"100%"},"row-key":"id"},{default:s(()=>[o(y,{label:"序号","min-width":"80",type:"index"}),o(y,{prop:"name",label:"配置名称","min-width":"240"}),o(y,{prop:"storage",label:"存储器类型","min-width":"240"},{default:s(t=>[t.row.storage===0?(n(),x("span",Ae,"本地磁盘")):f("",!0),t.row.storage===1?(n(),x("span",Be,"S3对象存储")):f("",!0)]),_:1}),o(y,{prop:"remark",label:"备注","min-width":"240"}),o(y,{prop:"master",label:"默认配置","min-width":"100"},{default:s(t=>[t.row.master?(n(),c(A,{key:0,type:"success"},{default:s(()=>[u("是")]),_:1})):(n(),c(A,{key:1,type:"danger"},{default:s(()=>[u("否")]),_:1}))]),_:1}),o(y,{prop:"createTime",label:"创建时间","min-width":"120"},{default:s(t=>[h("span",null,ae(e(_e)(t.row.createTime)),1)]),_:1}),o(y,{label:"操作",width:"240",fixed:"right"},{default:s(t=>[o(g,{size:"small",type:"primary",link:"",icon:e(le),onClick:T=>j(t.row)},{default:s(()=>[u("修改")]),_:2},1032,["icon","onClick"]),o(g,{size:"small",type:"primary",link:"",icon:e(te),onClick:T=>$(t.row)},{default:s(()=>[u("默认配置")]),_:2},1032,["icon","onClick"]),o(g,{size:"small",type:"primary",link:"",icon:e(oe),onClick:T=>M(t.row)},{default:s(()=>[u("删除")]),_:2},1032,["icon","onClick"])]),_:1})]),_:1},8,["data"])),[[W,e(E)]]),o(G,{"current-page":e(p).pageNo,"onUpdate:currentPage":l[1]||(l[1]=t=>e(p).pageNo=t),"page-size":e(p).pageSize,"onUpdate:pageSize":l[2]||(l[2]=t=>e(p).pageSize=t),"page-sizes":[10,20,30,50],layout:"total,sizes,prev, pager, next, jumper",background:"",small:"",onChange:b,total:e(p).total},null,8,["current-page","page-size","total"])]),o(Q,{modelValue:e(m),"onUpdate:modelValue":l[14]||(l[14]=t=>K(m)?m.value=t:m=t),title:e(w),width:"600px",draggable:""},{footer:s(()=>[h("span",Te,[o(g,{type:"primary",onClick:O},{default:s(()=>[u("确 定")]),_:1}),o(g,{onClick:l[13]||(l[13]=t=>{K(m)?m.value=!1:m=!1,v()})},{default:s(()=>[u("取 消")]),_:1})])]),default:s(()=>[o(F,{ref_key:"addFormRef",ref:C,model:e(a),"label-width":"120px","status-icon":"",rules:e(N)},{default:s(()=>[o(r,{label:"配置名称",prop:"name"},{default:s(()=>[o(i,{modelValue:e(a).name,"onUpdate:modelValue":l[3]||(l[3]=t=>e(a).name=t),placeholder:"请输入配置名称"},null,8,["modelValue"])]),_:1}),o(r,{label:"备注",prop:"remark"},{default:s(()=>[o(i,{modelValue:e(a).remark,"onUpdate:modelValue":l[4]||(l[4]=t=>e(a).remark=t),placeholder:"请输入备注"},null,8,["modelValue"])]),_:1}),o(r,{label:"存储器类型",prop:"storage"},{default:s(()=>[o(H,{modelValue:e(a).storage,"onUpdate:modelValue":l[5]||(l[5]=t=>e(a).storage=t),placeholder:"请选择存储器类型",disabled:e(V)},{default:s(()=>[(n(),c(B,{key:0,label:"本地磁盘",value:0})),(n(),c(B,{key:1,label:"S3对象存储",value:1}))]),_:1},8,["modelValue","disabled"])]),_:1}),e(a).storage===0?(n(),c(r,{key:0,label:"存储路径",prop:"basePath"},{default:s(()=>[o(i,{modelValue:e(a).basePath,"onUpdate:modelValue":l[6]||(l[6]=t=>e(a).basePath=t),placeholder:"请输入存储路径"},null,8,["modelValue"]),e(V)?(n(),c(S,{key:0,class:"mx-1",type:"danger"},{default:s(()=>[u("提示: 修改存储路径将会造成原有上传图片不能访问,建议新增存储策略")]),_:1})):f("",!0)]),_:1})):f("",!0),e(a).storage===1?(n(),c(r,{key:1,label:"节点地址",prop:"endpoint"},{default:s(()=>[o(i,{modelValue:e(a).endpoint,"onUpdate:modelValue":l[7]||(l[7]=t=>e(a).endpoint=t),placeholder:"请输入节点地址"},null,8,["modelValue"])]),_:1})):f("",!0),e(a).storage===1?(n(),c(r,{key:2,label:"存储bucket",prop:"bucket"},{default:s(()=>[o(i,{modelValue:e(a).bucket,"onUpdate:modelValue":l[8]||(l[8]=t=>e(a).bucket=t),placeholder:"请输入存储bucket"},null,8,["modelValue"])]),_:1})):f("",!0),e(a).storage===1?(n(),c(r,{key:3,label:"accessKey",prop:"accessKey"},{default:s(()=>[o(i,{modelValue:e(a).accessKey,"onUpdate:modelValue":l[9]||(l[9]=t=>e(a).accessKey=t),placeholder:"请输入accessKey"},null,8,["modelValue"])]),_:1})):f("",!0),e(a).storage===1?(n(),c(r,{key:4,label:"accessSecret",prop:"accessSecret"},{default:s(()=>[o(i,{modelValue:e(a).accessSecret,"onUpdate:modelValue":l[10]||(l[10]=t=>e(a).accessSecret=t),placeholder:"请输入accessSecret"},null,8,["modelValue"])]),_:1})):f("",!0),e(a).storage===1?(n(),c(r,{key:5,label:"上传目录",prop:"uploadDir"},{default:s(()=>[o(i,{modelValue:e(a).uploadDir,"onUpdate:modelValue":l[11]||(l[11]=t=>e(a).uploadDir=t),placeholder:"请输入上传目录"},null,8,["modelValue"]),o(S,{class:"mx-1",type:"info"},{default:s(()=>[u("支持{year},{month}, {day}占位符,不填写则上传至根目录")]),_:1})]),_:1})):f("",!0),e(a).storage===1?(n(),c(r,{key:6,label:"访问域名",prop:"domain"},{default:s(()=>[o(i,{modelValue:e(a).domain,"onUpdate:modelValue":l[12]||(l[12]=t=>e(a).domain=t),placeholder:"请输入访问域名"},null,8,["modelValue"]),o(S,{class:"mx-1",type:"info"},{default:s(()=>[u("如未配置访问域名,将采用节点地址 + 存储bucket的形式作为访问域名")]),_:1})]),_:1})):f("",!0)]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}};export{Le as default};
