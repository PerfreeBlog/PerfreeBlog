import{r as p,k as A,a as g,b as Q,d as y,e,w as o,u as a,C as J,f as r,D as S,G as T,H as W,j as w,h as X,N as Y,O as Z,i as B,m as _,q as ee,s as le,E as ae,y as te,Q as oe}from"./index-CihRDGxx.js";import{E as ie,a as ne,v as se}from"./el-table-column-CTu-3kzb.js";import"./el-dialog-DFE0lXHY.js";import"./el-tree-HJbZURUt.js";import{h as re}from"./perfree-nhCXPnWy.js";import{E as de}from"./el-tree-select--kPYs3el.js";import{E as me}from"./el-image-viewer-EMjiGCdX.js";import{E as ue,a as pe}from"./el-col-BEhwhFzy.js";import{c as ce,a as fe,b as _e,d as he,e as be}from"./category-BFkxnEz5.js";import{_ as ge}from"./attach-select-input-DKludTtF.js";import{E as ve}from"./index-DVZG1lLp.js";import{E as ye}from"./index-uh3ESdbA.js";import"./el-pagination-DVMT5liM.js";/* empty css                */import"./attach-BUqG8fMY.js";/* empty css                                                                            */import"./index-Bt2gs6dP.js";const we={class:"page"},Ve={class:"search-box"},Ee={class:"right-tool"},ke={class:"table-box"},xe={class:"dialog-footer"},Me={__name:"CategoryView",setup(Ce){const x=p(),h=p({name:""});let V=p(!1),E=p([]),C=p([]),s=p(!1),k=p("");const z=A({children:"children",label:"name",value:"id"}),i=p({pid:-1,id:"",name:"",desc:"",metaKeywords:"",thumbnail:"",slug:"",metaDescription:""}),O=A({pid:[{required:!0,message:"请选择父级分类",trigger:"blur"}],name:[{required:!0,message:"请输入分类名称",trigger:"blur"}]}),v=p();function c(){V.value=!0,ce(h.value).then(n=>{E.value=re(n.data,"id","pid","children",-1),C.value=[{id:-1,name:"主类目",children:E.value}],V.value=!1})}function K(){h.value={name:""},x.value.resetFields()}function D(n){b(),n&&n.id&&(i.value.pid=n.id),k.value="添加分类",s.value=!0}function b(){i.value={pid:-1,id:"",name:"",desc:"",metaKeywords:"",thumbnail:"",slug:"",metaDescription:""},v.value&&v.value.resetFields()}function N(){v.value.validate(n=>{n&&(i.value.id?fe(i.value).then(l=>{l.code===200?(_.success("修改成功"),s.value=!1,b(),c()):_.error(l.msg)}):_e(i.value).then(l=>{l.code===200?(_.success("添加成功"),s.value=!1,b(),c()):_.error(l.msg)}))})}function $(n){k.value="修改分类",b(),he(n.id).then(l=>{i.value=l.data,s.value=!0})}function q(n){ve.confirm("确定要删除["+n.name+"]吗？","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(()=>{be(n.id).then(l=>{l.code===200&&l.data?(_.success("删除成功"),c()):_.error(l.msg)})}).catch(()=>{})}return c(),(n,l)=>{const f=ee,d=le,m=ae,F=te,I=ue,L=pe,u=ie,G=me,R=oe,M=ne,j=de,H=ye,P=se;return g(),Q("div",we,[y("div",Ve,[e(F,{inline:!0,model:a(h),ref_key:"searchFormRef",ref:x},{default:o(()=>[e(d,{label:"分类名称"},{default:o(()=>[e(f,{modelValue:a(h).name,"onUpdate:modelValue":l[0]||(l[0]=t=>a(h).name=t),placeholder:"请输入分类名称",clearable:""},null,8,["modelValue"])]),_:1}),e(d,null,{default:o(()=>[e(m,{type:"primary",onClick:c,icon:a(J)},{default:o(()=>[r("查询")]),_:1},8,["icon"]),e(m,{icon:a(S),onClick:K},{default:o(()=>[r("重置")]),_:1},8,["icon"])]),_:1})]),_:1},8,["model"])]),e(L,{gutter:10,class:"mb8"},{default:o(()=>[e(I,{span:1.5},{default:o(()=>[e(m,{icon:a(T),type:"primary",plain:"",onClick:D},{default:o(()=>[r("新增")]),_:1},8,["icon"])]),_:1}),y("div",Ee,[e(m,{icon:a(S),circle:"",onClick:c},null,8,["icon"])])]),_:1}),y("div",ke,[W((g(),w(M,{data:a(E),style:{width:"100%",height:"100%"},"row-key":"id"},{default:o(()=>[e(u,{prop:"name",label:"分类名称",width:"240"}),e(u,{prop:"desc",label:"描述",width:"150"}),e(u,{prop:"count",label:"文章数量","min-width":"150"}),e(u,{prop:"slug",label:"slug","min-width":"150"}),e(u,{prop:"thumbnail",label:"封面图","min-width":"80"},{default:o(t=>[t.row.thumbnail?(g(),w(G,{key:0,style:{width:"100%","max-height":"100%"},src:t.row.thumbnail,"zoom-rate":1.2,"max-scale":7,"min-scale":.2,"preview-src-list":[t.row.thumbnail],"initial-index":4,"append-to-body":"",fit:"cover","preview-teleported":""},null,8,["src","preview-src-list"])):X("",!0)]),_:1}),e(u,{prop:"metaKeywords",label:"SEO关键字","min-width":"150"}),e(u,{prop:"metaDescription",label:"SEO描述","min-width":"150"}),e(u,{prop:"status",label:"状态",width:"80"},{default:o(t=>[t.row.status===0?(g(),w(R,{key:0,class:"ml-2",type:"success"},{default:o(()=>[r("正常")]),_:1})):(g(),w(R,{key:1,class:"ml-2",type:"danger"},{default:o(()=>[r("禁用")]),_:1}))]),_:1}),e(u,{label:"操作",width:"240",fixed:"right"},{default:o(t=>[e(m,{size:"small",type:"primary",link:"",icon:a(Y),onClick:U=>$(t.row)},{default:o(()=>[r("修改")]),_:2},1032,["icon","onClick"]),e(m,{size:"small",type:"primary",link:"",icon:a(T),onClick:U=>D(t.row)},{default:o(()=>[r("新增")]),_:2},1032,["icon","onClick"]),e(m,{size:"small",type:"primary",link:"",icon:a(Z),onClick:U=>q(t.row)},{default:o(()=>[r("删除")]),_:2},1032,["icon","onClick"])]),_:1})]),_:1},8,["data"])),[[P,a(V)]])]),e(H,{modelValue:a(s),"onUpdate:modelValue":l[9]||(l[9]=t=>B(s)?s.value=t:s=t),title:a(k),width:"600px",draggable:""},{footer:o(()=>[y("span",xe,[e(m,{type:"primary",onClick:N},{default:o(()=>[r("确 定")]),_:1}),e(m,{onClick:l[8]||(l[8]=t=>{B(s)?s.value=!1:s=!1,b()})},{default:o(()=>[r("取 消")]),_:1})])]),default:o(()=>[e(F,{ref_key:"addFormRef",ref:v,model:a(i),"label-width":"100px","status-icon":"",rules:a(O)},{default:o(()=>[e(d,{label:"父级分类",prop:"pid"},{default:o(()=>[e(j,{modelValue:a(i).pid,"onUpdate:modelValue":l[1]||(l[1]=t=>a(i).pid=t),data:a(C),props:a(z),"check-strictly":"","render-after-expand":!1,style:{width:"100%"},clearable:""},null,8,["modelValue","data","props"])]),_:1}),e(d,{label:"分类名称",prop:"name"},{default:o(()=>[e(f,{modelValue:a(i).name,"onUpdate:modelValue":l[2]||(l[2]=t=>a(i).name=t),placeholder:"请输入分类名称"},null,8,["modelValue"])]),_:1}),e(d,{label:"分类描述",prop:"desc"},{default:o(()=>[e(f,{modelValue:a(i).desc,"onUpdate:modelValue":l[3]||(l[3]=t=>a(i).desc=t),placeholder:"请输入分类描述",autosize:{minRows:3,maxRows:6},type:"textarea"},null,8,["modelValue"])]),_:1}),e(d,{label:"分类slug",prop:"slug"},{default:o(()=>[e(f,{modelValue:a(i).slug,"onUpdate:modelValue":l[4]||(l[4]=t=>a(i).slug=t),placeholder:"请输入分类slug"},null,8,["modelValue"])]),_:1}),e(d,{label:"封面图",prop:"thumbnail"},{default:o(()=>[e(ge,{"attach-type":"img","enable-input":!0,placeholder:"请选择封面图","model-value":a(i).thumbnail,"onUpdate:modelValue":l[5]||(l[5]=t=>a(i).thumbnail=t)},null,8,["model-value"])]),_:1}),e(d,{label:"SEO关键字",prop:"metaKeywords"},{default:o(()=>[e(f,{modelValue:a(i).metaKeywords,"onUpdate:modelValue":l[6]||(l[6]=t=>a(i).metaKeywords=t),placeholder:"请输入SEO关键字",autosize:{minRows:3,maxRows:6},type:"textarea"},null,8,["modelValue"])]),_:1}),e(d,{label:"SEO描述内容",prop:"metaDescription"},{default:o(()=>[e(f,{modelValue:a(i).metaDescription,"onUpdate:modelValue":l[7]||(l[7]=t=>a(i).metaDescription=t),placeholder:"请输入SEO描述内容",autosize:{minRows:3,maxRows:6},type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}};export{Me as default};
