import{a as X,b as Y,c as ee,d as ae,e as le,f as te}from"./attachConfig-C4U5uJ4c.js";import{r as b,l as oe,a as u,y as ne,b as r,d as D,e as V,f as o,w as n,u as e,z as se,h as c,B as P,C as re,D as de,k as m,i as g,t as ue,J as ie,M as ce,Z as me,N as pe,j as T,E as y,p as q}from"./index-sKYmNANA.js";const fe={class:"page"},ge={class:"search-box"},_e={class:"right-tool"},be={class:"table-box"},ke={key:0},ye={key:1},ve={class:"dialog-footer"},we={__name:"AttachConfigView",setup(he){let z=b([]),x=b(!1);const A=b();let p=b(!1),C=b(!1),S=b("");const w=b(),a=b({id:"",name:"",remark:"",storage:void 0,basePath:"",endpoint:"",bucket:"",accessKey:"",accessSecret:"",domain:"",uploadDir:""}),R=oe({name:[{required:!0,message:"请输入配置名称",trigger:"blur"}],storage:[{required:!0,message:"请选择存储器类型",trigger:"blur"}],basePath:[{required:!0,message:"请输入存储路径",trigger:"blur"}],endpoint:[{required:!0,message:"请输入节点地址",trigger:"blur"}],bucket:[{required:!0,message:"请输入存储bucket",trigger:"blur"}],accessKey:[{required:!0,message:"请输入accessKey",trigger:"blur"}],accessSecret:[{required:!0,message:"请输入accessSecret",trigger:"blur"}]}),f=b({pageNo:1,pageSize:20,total:0,name:""});function k(){x.value=!0,X(f.value).then(d=>{z.value=d.data.list,f.value.total=d.data.total,x.value=!1})}function M(){f.value={name:""},A.value.resetFields()}function E(){C.value=!1,S.value="新增配置",h(),p.value=!0}function h(){a.value={id:"",name:"",remark:"",storage:void 0,basePath:"",endpoint:"",bucket:"",accessKey:"",accessSecret:"",domain:"",uploadDir:""},w.value&&w.value.resetFields()}function j(){w.value.validate(d=>{if(d){let l;a.value.storage===0?l={basePath:a.value.basePath}:l={endpoint:a.value.endpoint,bucket:a.value.bucket,accessKey:a.value.accessKey,accessSecret:a.value.accessSecret,domain:a.value.domain,uploadDir:a.value.uploadDir};const i={id:a.value.id,name:a.value.name,remark:a.value.remark,storage:a.value.storage,config:JSON.stringify(l)};a.value.id?Y(i).then(s=>{s.code===200?(y.success("修改成功"),p.value=!1,h(),k()):y.error(s.msg)}):ee(i).then(s=>{s.code===200?(y.success("添加成功"),p.value=!1,h(),k()):y.error(s.msg)})}})}function J(d){if(d.master){y.error("默认配置不允许删除!");return}q.confirm("确定要删除["+d.name+"]吗？删除后该配置内上传的文件将无法展示!","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(()=>{ae(d.id).then(l=>{l.code===200&&l.data?(y.success("删除成功"),k()):y.error(l.msg)})}).catch(()=>{})}function O(d){C.value=!0,S.value="修改配置",h(),p.value=!0,le(d.id).then(l=>{a.value=Object.assign(l.data,JSON.parse(l.data.config))})}function $(d){q.confirm("确定要将除["+d.name+"]设置为主配置吗？","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(()=>{te({id:d.id}).then(l=>{y.success("修改成功"),k()})}).catch(()=>{})}return k(),(d,l)=>{const i=u("el-input"),s=u("el-form-item"),_=u("el-button"),F=u("el-form"),L=u("el-col"),Z=u("el-row"),v=u("el-table-column"),K=u("el-tag"),G=u("el-table"),H=u("el-pagination"),B=u("el-option"),I=u("el-select"),U=u("el-text"),Q=u("el-dialog"),W=ne("loading");return r(),D("div",fe,[V("div",ge,[o(F,{inline:!0,model:e(f),class:"demo-form-inline",ref_key:"searchFormRef",ref:A},{default:n(()=>[o(s,{label:"配置名称"},{default:n(()=>[o(i,{modelValue:e(f).name,"onUpdate:modelValue":l[0]||(l[0]=t=>e(f).name=t),placeholder:"请输入配置名称",clearable:""},null,8,["modelValue"])]),_:1}),o(s,null,{default:n(()=>[o(_,{type:"primary",onClick:k,icon:e(se)},{default:n(()=>[c("查询")]),_:1},8,["icon"]),o(_,{icon:e(P),onClick:M},{default:n(()=>[c("重置")]),_:1},8,["icon"])]),_:1})]),_:1},8,["model"])]),o(Z,{gutter:10,class:"mb8"},{default:n(()=>[o(L,{span:1.5},{default:n(()=>[o(_,{icon:e(re),type:"primary",plain:"",onClick:E},{default:n(()=>[c("新增")]),_:1},8,["icon"])]),_:1}),V("div",_e,[o(_,{icon:e(P),circle:"",onClick:k},null,8,["icon"])])]),_:1}),V("div",be,[de((r(),m(G,{data:e(z),style:{width:"100%",height:"100%"},"row-key":"id"},{default:n(()=>[o(v,{label:"序号","min-width":"80",type:"index"}),o(v,{prop:"name",label:"配置名称","min-width":"240"}),o(v,{prop:"storage",label:"存储器类型","min-width":"240"},{default:n(t=>[t.row.storage===0?(r(),D("span",ke,"本地磁盘")):g("",!0),t.row.storage===1?(r(),D("span",ye,"S3对象存储")):g("",!0)]),_:1}),o(v,{prop:"remark",label:"备注","min-width":"240"}),o(v,{prop:"master",label:"默认配置","min-width":"100"},{default:n(t=>[t.row.master?(r(),m(K,{key:0,type:"success"},{default:n(()=>[c("是")]),_:1})):(r(),m(K,{key:1,type:"danger"},{default:n(()=>[c("否")]),_:1}))]),_:1}),o(v,{prop:"createTime",label:"创建时间","min-width":"120"},{default:n(t=>[V("span",null,ue(e(ie)(t.row.createTime)),1)]),_:1}),o(v,{label:"操作",width:"240",fixed:"right"},{default:n(t=>[o(_,{size:"small",type:"primary",link:"",icon:e(ce),onClick:N=>O(t.row)},{default:n(()=>[c("修改")]),_:2},1032,["icon","onClick"]),o(_,{size:"small",type:"primary",link:"",icon:e(me),onClick:N=>$(t.row)},{default:n(()=>[c("默认配置")]),_:2},1032,["icon","onClick"]),o(_,{size:"small",type:"primary",link:"",icon:e(pe),onClick:N=>J(t.row)},{default:n(()=>[c("删除")]),_:2},1032,["icon","onClick"])]),_:1})]),_:1},8,["data"])),[[W,e(x)]]),o(H,{"current-page":e(f).pageNo,"onUpdate:currentPage":l[1]||(l[1]=t=>e(f).pageNo=t),"page-size":e(f).pageSize,"onUpdate:pageSize":l[2]||(l[2]=t=>e(f).pageSize=t),"page-sizes":[10,20,30,50],layout:"total,sizes,prev, pager, next, jumper",background:"",small:"",onChange:k,total:e(f).total},null,8,["current-page","page-size","total"])]),o(Q,{modelValue:e(p),"onUpdate:modelValue":l[14]||(l[14]=t=>T(p)?p.value=t:p=t),title:e(S),width:"600px",draggable:""},{footer:n(()=>[V("span",ve,[o(_,{type:"primary",onClick:j},{default:n(()=>[c("确 定")]),_:1}),o(_,{onClick:l[13]||(l[13]=t=>{T(p)?p.value=!1:p=!1,h()})},{default:n(()=>[c("取 消")]),_:1})])]),default:n(()=>[o(F,{ref_key:"addFormRef",ref:w,model:e(a),"label-width":"120px","status-icon":"",rules:e(R)},{default:n(()=>[o(s,{label:"配置名称",prop:"name"},{default:n(()=>[o(i,{modelValue:e(a).name,"onUpdate:modelValue":l[3]||(l[3]=t=>e(a).name=t),placeholder:"请输入配置名称"},null,8,["modelValue"])]),_:1}),o(s,{label:"备注",prop:"remark"},{default:n(()=>[o(i,{modelValue:e(a).remark,"onUpdate:modelValue":l[4]||(l[4]=t=>e(a).remark=t),placeholder:"请输入备注"},null,8,["modelValue"])]),_:1}),o(s,{label:"存储器类型",prop:"storage"},{default:n(()=>[o(I,{modelValue:e(a).storage,"onUpdate:modelValue":l[5]||(l[5]=t=>e(a).storage=t),placeholder:"请选择存储器类型",disabled:e(C)},{default:n(()=>[(r(),m(B,{key:0,label:"本地磁盘",value:0})),(r(),m(B,{key:1,label:"S3对象存储",value:1}))]),_:1},8,["modelValue","disabled"])]),_:1}),e(a).storage===0?(r(),m(s,{key:0,label:"存储路径",prop:"basePath"},{default:n(()=>[o(i,{modelValue:e(a).basePath,"onUpdate:modelValue":l[6]||(l[6]=t=>e(a).basePath=t),placeholder:"请输入存储路径"},null,8,["modelValue"]),e(C)?(r(),m(U,{key:0,class:"mx-1",type:"danger"},{default:n(()=>[c("提示: 修改存储路径将会造成原有上传图片不能访问,建议新增存储策略")]),_:1})):g("",!0)]),_:1})):g("",!0),e(a).storage===1?(r(),m(s,{key:1,label:"节点地址",prop:"endpoint"},{default:n(()=>[o(i,{modelValue:e(a).endpoint,"onUpdate:modelValue":l[7]||(l[7]=t=>e(a).endpoint=t),placeholder:"请输入节点地址"},null,8,["modelValue"])]),_:1})):g("",!0),e(a).storage===1?(r(),m(s,{key:2,label:"存储bucket",prop:"bucket"},{default:n(()=>[o(i,{modelValue:e(a).bucket,"onUpdate:modelValue":l[8]||(l[8]=t=>e(a).bucket=t),placeholder:"请输入存储bucket"},null,8,["modelValue"])]),_:1})):g("",!0),e(a).storage===1?(r(),m(s,{key:3,label:"accessKey",prop:"accessKey"},{default:n(()=>[o(i,{modelValue:e(a).accessKey,"onUpdate:modelValue":l[9]||(l[9]=t=>e(a).accessKey=t),placeholder:"请输入accessKey"},null,8,["modelValue"])]),_:1})):g("",!0),e(a).storage===1?(r(),m(s,{key:4,label:"accessSecret",prop:"accessSecret"},{default:n(()=>[o(i,{modelValue:e(a).accessSecret,"onUpdate:modelValue":l[10]||(l[10]=t=>e(a).accessSecret=t),placeholder:"请输入accessSecret"},null,8,["modelValue"])]),_:1})):g("",!0),e(a).storage===1?(r(),m(s,{key:5,label:"上传目录",prop:"uploadDir"},{default:n(()=>[o(i,{modelValue:e(a).uploadDir,"onUpdate:modelValue":l[11]||(l[11]=t=>e(a).uploadDir=t),placeholder:"请输入上传目录"},null,8,["modelValue"]),o(U,{class:"mx-1",type:"info"},{default:n(()=>[c("支持{year},{month}, {day}占位符,不填写则上传至根目录")]),_:1})]),_:1})):g("",!0),e(a).storage===1?(r(),m(s,{key:6,label:"访问域名",prop:"domain"},{default:n(()=>[o(i,{modelValue:e(a).domain,"onUpdate:modelValue":l[12]||(l[12]=t=>e(a).domain=t),placeholder:"请输入访问域名"},null,8,["modelValue"]),o(U,{class:"mx-1",type:"info"},{default:n(()=>[c("如未配置访问域名,将采用节点地址 + 存储bucket的形式作为访问域名")]),_:1})]),_:1})):g("",!0)]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}};export{we as default};
